---
title: 匹配key
author:
category: Redis
tag: Redis
---

## 不要使用keys

KEYS 命令在 Redis 中是阻塞的，它会一次性返回与给定模式匹配的所有键。如果 Redis 数据库非常大，或者匹配的键数量庞大，使用 KEYS
命令可能会阻塞服务器并导致性能问题。此外，由于 KEYS 命令的执行是阻塞的，其他客户端的请求也会被延迟。

## 推荐使用scan

SCAN 命令使用游标方式迭代 Redis 键空间，允许逐步获取匹配模式的键。这样可以将工作分散到多个迭代中，减少对服务器的阻塞时间，并且不会导致性能问题。
使用 SCAN 命令可以更好地处理大型数据库和大量键的情况，并且对于生产环境更加安全。

语法如下：

```bash
SCAN cursor [MATCH pattern] [COUNT count]
```

示例：

```bash
SCAN 0 match "cache:*" count 100
```

SCAN 命令将返回一个包含两个元素的数组：
第一个元素是下一个迭代的游标，第二个元素是与pattern匹配的键。
可以使用返回的游标来进行下一次迭代，直到返回的游标为 0，表示迭代完成。

## scan的问题

- **可能会产生重复键**：在某些情况下，SCAN 命令可能会返回重复的键。这是因为在迭代过程中有新的键被添加或删除，而新键的添加或删除可能导致某些键被返回多次。

- **迭代过程可能不是实时的**：SCAN
  命令使用游标方式迭代键空间，这意味着在多次迭代之间可能会有新的键被添加或删除。因此，如果在迭代过程中有新的键被添加或删除，那么这些新键可能会在当前迭代中被忽略，需要等到下一次迭代才能获取到。这可能导致在某些情况下无法实时获取到最新的键集合。
- **可能会产生重复键**：在某些情况下，SCAN
  命令可能会返回重复的键。这是因为在迭代过程中有新的键被添加或删除，而新键的添加或删除可能导致某些键被返回多次。为了解决这个问题，应用程序需要在客户端端进行去重操作。

<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.6" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.22" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hollowlatte.github.io/Note-Book/Note-Book/distributed-system/protocol/gossip-protocl.html"><meta property="og:site_name" content="Note-Book"><meta property="og:title" content="Gossip 协议详解"><meta property="og:description" content="背景 在分布式系统中，不同的节点进行数据/信息共享是一个基本的需求。 一种比较简单粗暴的方法就是 集中式发散消息，简单来说就是一个主节点同时共享最新信息给其他所有节点，比较适合中心化系统。这种方法的缺陷也很明显，节点多的时候不光同步消息的效率低，还太依赖与中心节点，存在单点风险问题。 于是，分散式发散消息 的 Gossip 协议 就诞生了。 Gossi..."><meta property="og:type" content="article"><meta property="og:image" content="https://oscimg.oschina.net/oscnet/up-fcacc1eefca6e51354a5f1fc9f2919f51ec.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-27T18:36:54.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Gossip 协议详解"><meta property="article:author" content="Hollow-Latte"><meta property="article:tag" content="分布式协议&算法"><meta property="article:tag" content="共识算法"><meta property="article:modified_time" content="2024-03-27T18:36:54.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Gossip 协议详解","image":["https://oscimg.oschina.net/oscnet/up-fcacc1eefca6e51354a5f1fc9f2919f51ec.png","https://oscimg.oschina.net/oscnet/up-df16e98bf71e872a7e1f01ca31cee93d77b.png","https://oss.javaguide.cn/github/javaguide/csdn/20210605170707933.png"],"dateModified":"2024-03-27T18:36:54.000Z","author":[{"@type":"Person","name":"Hollow-Latte","url":"https://hollowlatte.github.io/Note-Book"}]}</script><meta name="robots" content="all"><meta name="author" content="Guide"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java基础, 多线程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, 系统设计, 分布式, RPC, 高可用, 高并发"><meta name="apple-mobile-web-app-capable" content="yes"><script>var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();</script><link ref="preconnect" href="https://fonts.googleapis.com"><link ref="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link ref="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"><link rel="alternate" type="application/atom+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/atom.xml" title="Note-Book Atom Feed"><link rel="alternate" type="application/json" href="https://hollowlatte.github.io/Note-Book/Note-Book/feed.json" title="Note-Book JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/rss.xml" title="Note-Book RSS Feed"><link rel="icon" href="/Note-Book/favicon.ico"><title>Gossip 协议详解 | Note-Book</title><meta name="description" content="背景 在分布式系统中，不同的节点进行数据/信息共享是一个基本的需求。 一种比较简单粗暴的方法就是 集中式发散消息，简单来说就是一个主节点同时共享最新信息给其他所有节点，比较适合中心化系统。这种方法的缺陷也很明显，节点多的时候不光同步消息的效率低，还太依赖与中心节点，存在单点风险问题。 于是，分散式发散消息 的 Gossip 协议 就诞生了。 Gossi...">
    <link rel="preload" href="/Note-Book/assets/style-bCPtHIxr.css" as="style"><link rel="stylesheet" href="/Note-Book/assets/style-bCPtHIxr.css">
    <link rel="modulepreload" href="/Note-Book/assets/app-DNRIH2TH.js"><link rel="modulepreload" href="/Note-Book/assets/gossip-protocl.html-C8uxrJLk.js"><link rel="modulepreload" href="/Note-Book/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/Note-Book/"><img class="vp-nav-logo" src="/Note-Book/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Note-Book</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/home.html" aria-label="面试指南"><FontIcon icon="java"></FontIcon>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="🧐研究"><span class="title"><FontIcon></FontIcon>🧐研究</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/open-source-project/" aria-label="开源项目"><FontIcon icon="github"></FontIcon>开源项目<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/interesting/" aria-label="好玩的"><FontIcon icon="github"></FontIcon>好玩的<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/business/" aria-label="😋业务"><FontIcon></FontIcon>😋业务<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/practice-manual/" aria-label="😎实践手册"><FontIcon icon="about"></FontIcon>😎实践手册<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="😰问题集合"><span class="title"><FontIcon></FontIcon>😰问题集合</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/backend-problem/" aria-label="后端问题"><FontIcon icon="github"></FontIcon>后端问题<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/frontend-problem/" aria-label="前端问题"><FontIcon icon="github"></FontIcon>前端问题<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/non-dev/" aria-label="非开发问题"><FontIcon icon="github"></FontIcon>非开发问题<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/interview-shorthand/" aria-label="💯面试速记"><FontIcon icon="about"></FontIcon>💯面试速记<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/notebook/" aria-label="🫵笔记本"><FontIcon icon="book"></FontIcon>🫵笔记本<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/algorithm/" aria-label="🧮算法"><FontIcon icon="book"></FontIcon>🧮算法<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="🤣网站相关"><span class="title"><FontIcon icon="about"></FontIcon>🤣网站相关</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/about-the-author/" aria-label="关于作者"><FontIcon icon="zuozhe"></FontIcon>关于作者<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/timeline/" aria-label="更新历史"><FontIcon icon="history"></FontIcon>更新历史<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/HollowLatte/Note-Book" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><GitHubIcon style="width:1.25rem;height:1.25rem;vertical-align:middle;"></GitHubIcon></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">必看</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="interview"></FontIcon><span class="vp-sidebar-title">面试准备</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="java"></FontIcon><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="computer"></FontIcon><span class="vp-sidebar-title">计算机基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="database"></FontIcon><span class="vp-sidebar-title">数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="tool"></FontIcon><span class="vp-sidebar-title">开发工具</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="component"></FontIcon><span class="vp-sidebar-title">常用框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="design"></FontIcon><span class="vp-sidebar-title">系统设计</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="distributed-network"></FontIcon><span class="vp-sidebar-title">分布式</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="suanfaku"></FontIcon><span class="vp-sidebar-title">理论&amp;算法&amp;协议</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/protocol/cap-and-base-theorem.html" aria-label="CAP &amp; BASE理论详解"><FontIcon></FontIcon>CAP &amp; BASE理论详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/protocol/paxos-algorithm.html" aria-label="Paxos 算法详解"><FontIcon></FontIcon>Paxos 算法详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/protocol/raft-algorithm.html" aria-label="Raft 算法详解"><FontIcon></FontIcon>Raft 算法详解<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!----></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="gateway"></FontIcon><span class="vp-sidebar-title">API网关</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/api-gateway.html" aria-label="API网关基础知识总结"><FontIcon></FontIcon>API网关基础知识总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/spring-cloud-gateway-questions.html" aria-label="Spring Cloud Gateway常见问题总结"><FontIcon></FontIcon>Spring Cloud Gateway常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="id"></FontIcon><span class="vp-sidebar-title">分布式ID</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/distributed-id.html" aria-label="分布式ID介绍&amp;实现方案总结"><FontIcon></FontIcon>分布式ID介绍&amp;实现方案总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/distributed-id-design.html" aria-label="分布式ID设计指南"><FontIcon></FontIcon>分布式ID设计指南<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="lock"></FontIcon><span class="vp-sidebar-title">分布式锁</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/distributed-lock.html" aria-label="分布式锁介绍"><FontIcon></FontIcon>分布式锁介绍<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/distributed-system/distributed-lock-implementations.html" aria-label="分布式锁常见实现方案总结"><FontIcon></FontIcon>分布式锁常见实现方案总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="network"></FontIcon><span class="vp-sidebar-title">RPC</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="framework"></FontIcon><span class="vp-sidebar-title">ZooKeeper</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="transanction"></FontIcon><span class="vp-sidebar-title">分布式事务</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="configuration"></FontIcon><span class="vp-sidebar-title">分布式配置中心</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="et-performance"></FontIcon><span class="vp-sidebar-title">高性能</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="highavailable"></FontIcon><span class="vp-sidebar-title">高可用</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><FontIcon></FontIcon>Gossip 协议详解</h1><div class="page-info"><AuthorInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></AuthorInfo><CategoryInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></CategoryInfo><TagInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></TagInfo><DateInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></DateInfo><OriginalInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></OriginalInfo><WordInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></WordInfo><ReadingTimeInfo localizeddate="2024年3月27日" isoriginal="false" pageview="true" pure="true"></ReadingTimeInfo></div><hr></div><!----><!--[--><!----><!--]--><div class="theme-hope-content"><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景"><span>背景</span></a></h2><p>在分布式系统中，不同的节点进行数据/信息共享是一个基本的需求。</p><p>一种比较简单粗暴的方法就是 <strong>集中式发散消息</strong>，简单来说就是一个主节点同时共享最新信息给其他所有节点，比较适合中心化系统。这种方法的缺陷也很明显，节点多的时候不光同步消息的效率低，还太依赖与中心节点，存在单点风险问题。</p><p>于是，<strong>分散式发散消息</strong> 的 <strong>Gossip 协议</strong> 就诞生了。</p><h2 id="gossip-协议介绍" tabindex="-1"><a class="header-anchor" href="#gossip-协议介绍"><span>Gossip 协议介绍</span></a></h2><p>Gossip 直译过来就是闲话、流言蜚语的意思。流言蜚语有什么特点呢？容易被传播且传播速度还快，你传我我传他，然后大家都知道了。</p><figure><img src="/Note-Book/assets/gossip-CzcFfu4W.png" alt="" tabindex="0"><figcaption></figcaption></figure><p><strong>Gossip 协议</strong> 也叫 Epidemic 协议（流行病协议）或者 Epidemic propagation 算法（疫情传播算法），别名很多。不过，这些名字的特点都具有 <strong>随机传播特性</strong> （联想一下病毒传播、癌细胞扩散等生活中常见的情景），这也正是 Gossip 协议最主要的特点。</p><p>Gossip 协议最早是在 ACM 上的一篇 1987 年发表的论文 <a href="https://dl.acm.org/doi/10.1145/41840.41841" target="_blank" rel="noopener noreferrer">《Epidemic Algorithms for Replicated Database Maintenance》<!----></a>中被提出的。根据论文标题，我们大概就能知道 Gossip 协议当时提出的主要应用是在分布式数据库系统中各个副本节点同步数据。</p><p>正如 Gossip 协议其名一样，这是一种随机且带有传染性的方式将信息传播到整个网络中，并在一定时间内，使得系统内的所有节点数据一致。</p><p>在 Gossip 协议下，没有所谓的中心节点，每个节点周期性地随机找一个节点互相同步彼此的信息，理论上来说，各个节点的状态最终会保持一致。</p><p>下面我们来对 Gossip 协议的定义做一个总结：<strong>Gossip 协议是一种允许在分布式系统中共享状态的去中心化通信协议，通过这种通信协议，我们可以将信息传播给网络或集群中的所有成员。</strong></p><h2 id="gossip-协议应用" tabindex="-1"><a class="header-anchor" href="#gossip-协议应用"><span>Gossip 协议应用</span></a></h2><p>NoSQL 数据库 Redis 和 Apache Cassandra、服务网格解决方案 Consul 等知名项目都用到了 Gossip 协议，学习 Gossip 协议有助于我们搞清很多技术的底层原理。</p><p>我们这里以 Redis Cluster 为例说明 Gossip 协议的实际应用。</p><p>我们经常使用的分布式缓存 Redis 的官方集群解决方案（3.0 版本引入） Redis Cluster 就是基于 Gossip 协议来实现集群中各个节点数据的最终一致性。</p><figure><img src="https://oscimg.oschina.net/oscnet/up-fcacc1eefca6e51354a5f1fc9f2919f51ec.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>Redis Cluster 是一个典型的分布式系统，分布式系统中的各个节点需要互相通信。既然要相互通信就要遵循一致的通信协议，Redis Cluster 中的各个节点基于 <strong>Gossip 协议</strong> 来进行通信共享信息，每个 Redis 节点都维护了一份集群的状态信息。</p><p>Redis Cluster 的节点之间会相互发送多种 Gossip 消息：</p><ul><li><strong>MEET</strong>：在 Redis Cluster 中的某个 Redis 节点上执行 <code>CLUSTER MEET ip port</code> 命令，可以向指定的 Redis 节点发送一条 MEET 信息，用于将其添加进 Redis Cluster 成为新的 Redis 节点。</li><li><strong>PING/PONG</strong>：Redis Cluster 中的节点都会定时地向其他节点发送 PING 消息，来交换各个节点状态信息，检查各个节点状态，包括在线状态、疑似下线状态 PFAIL 和已下线状态 FAIL。</li><li><strong>FAIL</strong>：Redis Cluster 中的节点 A 发现 B 节点 PFAIL ，并且在下线报告的有效期限内集群中半数以上的节点将 B 节点标记为 PFAIL，节点 A 就会向集群广播一条 FAIL 消息，通知其他节点将故障节点 B 标记为 FAIL 。</li><li>......</li></ul><p>下图就是主从架构的 Redis Cluster 的示意图，图中的虚线代表的就是各个节点之间使用 Gossip 进行通信 ，实线表示主从复制。</p><figure><img src="/Note-Book/assets/redis-cluster-gossip-B87ioOq3.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>有了 Redis Cluster 之后，不需要专门部署 Sentinel 集群服务了。Redis Cluster 相当于是内置了 Sentinel 机制，Redis Cluster 内部的各个 Redis 节点通过 Gossip 协议互相探测健康状态，在故障时可以自动切换。</p><p>关于 Redis Cluster 的详细介绍，可以查看这篇文章 <a href="https://javaguide.cn/database/redis/redis-cluster.html" target="_blank" rel="noopener noreferrer">Redis 集群详解(付费)<!----></a> 。</p><h2 id="gossip-协议消息传播模式" tabindex="-1"><a class="header-anchor" href="#gossip-协议消息传播模式"><span>Gossip 协议消息传播模式</span></a></h2><p>Gossip 设计了两种可能的消息传播模式：<strong>反熵（Anti-Entropy）</strong> 和 <strong>传谣（Rumor-Mongering）</strong>。</p><h3 id="反熵-anti-entropy" tabindex="-1"><a class="header-anchor" href="#反熵-anti-entropy"><span>反熵(Anti-entropy)</span></a></h3><p>根据维基百科：</p><blockquote><p>熵的概念最早起源于<a href="https://zh.wikipedia.org/wiki/%E7%89%A9%E7%90%86%E5%AD%A6" target="_blank" rel="noopener noreferrer">物理学<!----></a>，用于度量一个热力学系统的混乱程度。熵最好理解为不确定性的量度而不是确定性的量度，因为越随机的信源的熵越大。</p></blockquote><p>在这里，你可以把反熵中的熵了解为节点之间数据的混乱程度/差异性，反熵就是指消除不同节点中数据的差异，提升节点间数据的相似度，从而降低熵值。</p><p>具体是如何反熵的呢？集群中的节点，每隔段时间就随机选择某个其他节点，然后通过互相交换自己的所有数据来消除两者之间的差异，实现数据的最终一致性。</p><p>在实现反熵的时候，主要有推、拉和推拉三种方式：</p><ul><li>推方式，就是将自己的所有副本数据，推给对方，修复对方副本中的熵。</li><li>拉方式，就是拉取对方的所有副本数据，修复自己副本中的熵。</li><li>推拉就是同时修复自己副本和对方副本中的熵。</li></ul><p>伪代码如下：</p><figure><img src="https://oscimg.oschina.net/oscnet/up-df16e98bf71e872a7e1f01ca31cee93d77b.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>在我们实际应用场景中，一般不会采用随机的节点进行反熵，而是需要可以的设计一个闭环。这样的话，我们能够在一个确定的时间范围内实现各个节点数据的最终一致性，而不是基于随机的概率。像 InfluxDB 就是这样来实现反熵的。</p><figure><img src="/Note-Book/assets/反熵-闭环-BPAGw_p4.png" alt="" tabindex="0"><figcaption></figcaption></figure><ol><li>节点 A 推送数据给节点 B，节点 B 获取到节点 A 中的最新数据。</li><li>节点 B 推送数据给 C，节点 C 获取到节点 A，B 中的最新数据。</li><li>节点 C 推送数据给 A，节点 A 获取到节点 B，C 中的最新数据。</li><li>节点 A 再推送数据给 B 形成闭环，这样节点 B 就获取到节点 C 中的最新数据。</li></ol><p>虽然反熵很简单实用，但是，节点过多或者节点动态变化的话，反熵就不太适用了。这个时候，我们想要实现最终一致性就要靠 <strong>谣言传播(Rumor mongering)</strong> 。</p><h3 id="谣言传播-rumor-mongering" tabindex="-1"><a class="header-anchor" href="#谣言传播-rumor-mongering"><span>谣言传播(Rumor mongering)</span></a></h3><p>谣言传播指的是分布式系统中的一个节点一旦有了新数据之后，就会变为活跃节点，活跃节点会周期性地联系其他节点向其发送新数据，直到所有的节点都存储了该新数据。</p><p>如下图所示（下图来自于<a href="https://managementfromscratch.wordpress.com/2016/04/01/introduction-to-gossip/" target="_blank" rel="noopener noreferrer">INTRODUCTION TO GOSSIP<!----></a> 这篇文章）：</p><p>![Gossip 传播示意图](./images/gossip/gossip-rumor- mongering.gif)</p><p>伪代码如下：</p><figure><img src="https://oss.javaguide.cn/github/javaguide/csdn/20210605170707933.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>谣言传播比较适合节点数量比较多的情况，不过，这种模式下要尽量避免传播的信息包不能太大，避免网络消耗太大。</p><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结"><span>总结</span></a></h3><ul><li>反熵（Anti-Entropy）会传播节点的所有数据，而谣言传播（Rumor-Mongering）只会传播节点新增的数据。</li><li>我们一般会给反熵设计一个闭环。</li><li>谣言传播（Rumor-Mongering）比较适合节点数量比较多或者节点动态变化的场景。</li></ul><h2 id="gossip-协议优势和缺陷" tabindex="-1"><a class="header-anchor" href="#gossip-协议优势和缺陷"><span>Gossip 协议优势和缺陷</span></a></h2><p><strong>优势：</strong></p><p>1、相比于其他分布式协议/算法来说，Gossip 协议理解起来非常简单。</p><p>2、能够容忍网络上节点的随意地增加或者减少，宕机或者重启，因为 Gossip 协议下这些节点都是平等的，去中心化的。新增加或者重启的节点在理想情况下最终是一定会和其他节点的状态达到一致。</p><p>3、速度相对较快。节点数量比较多的情况下，扩散速度比一个主节点向其他节点传播信息要更快（多播）。</p><p><strong>缺陷</strong> :</p><p>1、消息需要通过多个传播的轮次才能传播到整个网络中，因此，必然会出现各节点状态不一致的情况。毕竟，Gossip 协议强调的是最终一致，至于达到各个节点的状态一致需要多长时间，谁也无从得知。</p><p>2、由于拜占庭将军问题，不允许存在恶意节点。</p><p>3、可能会出现消息冗余的问题。由于消息传播的随机性，同一个节点可能会重复收到相同的消息。</p><h2 id="总结-1" tabindex="-1"><a class="header-anchor" href="#总结-1"><span>总结</span></a></h2><ul><li>Gossip 协议是一种允许在分布式系统中共享状态的通信协议，通过这种通信协议，我们可以将信息传播给网络或集群中的所有成员。</li><li>Gossip 协议被 Redis、Apache Cassandra、Consul 等项目应用。</li><li>谣言传播（Rumor-Mongering）比较适合节点数量比较多或者节点动态变化的场景。</li></ul><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li>一万字详解 Redis Cluster Gossip 协议：https://segmentfault.com/a/1190000038373546</li><li>《分布式协议与算法实战》</li><li>《Redis 设计与实现》</li></ul></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/HollowLatte/Note-Book/edit/main/docs/distributed-system/protocol/gossip-protocl.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: hollowlatte@outlook.com">hollowlatte</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/Note-Book/distributed-system/protocol/raft-algorithm.html" aria-label="Raft 算法详解"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><FontIcon></FontIcon>Raft 算法详解</div></a><!----></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">鄂ICP备2020015769号-1</a></div><div class="vp-copyright">Copyright © 2024 Hollow-Latte </div></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/Note-Book/assets/app-DNRIH2TH.js" defer></script>
  </body>
</html>

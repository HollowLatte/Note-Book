<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.6" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.22" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta name="keywords" content="Java SPIæœºåˆ¶"><meta name="description" content="SPI å³ Service Provider Interface ï¼Œå­—é¢æ„æ€å°±æ˜¯ï¼šâ€œæœåŠ¡æä¾›è€…çš„æ¥å£â€ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼šä¸“é—¨æä¾›ç»™æœåŠ¡æä¾›è€…æˆ–è€…æ‰©å±•æ¡†æ¶åŠŸèƒ½çš„å¼€å‘è€…å»ä½¿ç”¨çš„ä¸€ä¸ªæ¥å£ã€‚SPI å°†æœåŠ¡æ¥å£å’Œå…·ä½“çš„æœåŠ¡å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå°†æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°è€…è§£è€¦ï¼Œèƒ½å¤Ÿæå‡ç¨‹åºçš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚ä¿®æ”¹æˆ–è€…æ›¿æ¢æœåŠ¡å®ç°å¹¶ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹ã€‚"><meta property="og:url" content="https://hollowlatte.github.io/Note-Book/Note-Book/java/basis/spi.html"><meta property="og:site_name" content="Note-Book"><meta property="og:title" content="Java SPI æœºåˆ¶è¯¦è§£"><meta property="og:description" content="æœ¬æ–‡æ¥è‡ª Kingshion æŠ•ç¨¿ã€‚æ¬¢è¿æ›´å¤šæœ‹å‹å‚ä¸åˆ° JavaGuide çš„ç»´æŠ¤å·¥ä½œï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚è¯¦ç»†ä¿¡æ¯è¯·çœ‹ï¼šJavaGuide è´¡çŒ®æŒ‡å— ã€‚ åœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä¸­ï¼Œä¸€èˆ¬æ¨èæ¨¡å—ä¹‹é—´åŸºäºæ¥å£ç¼–ç¨‹ï¼Œé€šå¸¸æƒ…å†µä¸‹è°ƒç”¨æ–¹æ¨¡å—æ˜¯ä¸ä¼šæ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹æ¨¡å—çš„å†…éƒ¨å…·ä½“å®ç°ã€‚ä¸€æ—¦ä»£ç é‡Œé¢æ¶‰åŠå…·ä½“å®ç°ç±»ï¼Œå°±è¿åäº†å¼€é—­åŸåˆ™ã€‚å¦‚æœéœ€è¦æ›¿æ¢ä¸€ç§å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹..."><meta property="og:type" content="article"><meta property="og:image" content="https://oss.javaguide.cn/github/javaguide/java/basis/spi/22e1830e0b0e4115a882751f6c417857tplv-k3u1fbpfcp-zoom-1.jpeg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-26T15:40:23.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Java SPI æœºåˆ¶è¯¦è§£"><meta property="article:author" content="Hollow-Latte"><meta property="article:tag" content="JavaåŸºç¡€"><meta property="article:modified_time" content="2024-03-26T15:40:23.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java SPI æœºåˆ¶è¯¦è§£","image":["https://oss.javaguide.cn/github/javaguide/java/basis/spi/22e1830e0b0e4115a882751f6c417857tplv-k3u1fbpfcp-zoom-1.jpeg","https://oss.javaguide.cn/github/javaguide/java/basis/spi/1ebd1df862c34880bc26b9d494535b3dtplv-k3u1fbpfcp-watermark.png","https://oss.javaguide.cn/github/javaguide/java/basis/spi/image-20220723213306039-165858318917813.png","https://oss.javaguide.cn/github/javaguide/java/basis/spi/523d5e25198444d3b112baf68ce49daetplv-k3u1fbpfcp-watermark.png","https://oss.javaguide.cn/github/javaguide/java/basis/spi/f4ba0aa71e9b4d509b9159892a220850tplv-k3u1fbpfcp-watermark.png","https://oss.javaguide.cn/github/javaguide/java/basis/spi/image-20220723215812708-165858469599214.png"],"dateModified":"2024-03-26T15:40:23.000Z","author":[{"@type":"Person","name":"Hollow-Latte","url":"https://hollowlatte.github.io/Note-Book"}]}</script><meta name="robots" content="all"><meta name="author" content="Guide"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="apple-mobile-web-app-capable" content="yes"><script>var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();</script><link ref="preconnect" href="https://fonts.googleapis.com"><link ref="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link ref="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"><link rel="alternate" type="application/atom+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/atom.xml" title="Note-Book Atom Feed"><link rel="alternate" type="application/json" href="https://hollowlatte.github.io/Note-Book/Note-Book/feed.json" title="Note-Book JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/rss.xml" title="Note-Book RSS Feed"><link rel="icon" href="/Note-Book/favicon.ico"><title>Java SPI æœºåˆ¶è¯¦è§£ | Note-Book</title>
    <link rel="preload" href="/Note-Book/assets/style-bCPtHIxr.css" as="style"><link rel="stylesheet" href="/Note-Book/assets/style-bCPtHIxr.css">
    <link rel="modulepreload" href="/Note-Book/assets/app-4HbIzINy.js"><link rel="modulepreload" href="/Note-Book/assets/spi.html-DinubAwg.js"><link rel="modulepreload" href="/Note-Book/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/Note-Book/"><img class="vp-nav-logo" src="/Note-Book/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Note-Book</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/home.html" aria-label="é¢è¯•æŒ‡å—"><FontIcon icon="java"></FontIcon>é¢è¯•æŒ‡å—<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ğŸ§ç ”ç©¶"><span class="title"><FontIcon></FontIcon>ğŸ§ç ”ç©¶</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/open-source-project/" aria-label="å¼€æºé¡¹ç›®"><FontIcon icon="github"></FontIcon>å¼€æºé¡¹ç›®<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/interesting/" aria-label="å¥½ç©çš„"><FontIcon icon="github"></FontIcon>å¥½ç©çš„<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/business/" aria-label="ğŸ˜‹ä¸šåŠ¡"><FontIcon></FontIcon>ğŸ˜‹ä¸šåŠ¡<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/practice-manual/" aria-label="ğŸ˜å®è·µæ‰‹å†Œ"><FontIcon icon="about"></FontIcon>ğŸ˜å®è·µæ‰‹å†Œ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ğŸ˜°é—®é¢˜é›†åˆ"><span class="title"><FontIcon></FontIcon>ğŸ˜°é—®é¢˜é›†åˆ</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/backend-problem/" aria-label="åç«¯é—®é¢˜"><FontIcon icon="github"></FontIcon>åç«¯é—®é¢˜<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/frontend-problem/" aria-label="å‰ç«¯é—®é¢˜"><FontIcon icon="github"></FontIcon>å‰ç«¯é—®é¢˜<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/non-dev/" aria-label="éå¼€å‘é—®é¢˜"><FontIcon icon="github"></FontIcon>éå¼€å‘é—®é¢˜<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/interview-shorthand/" aria-label="ğŸ’¯é¢è¯•é€Ÿè®°"><FontIcon icon="about"></FontIcon>ğŸ’¯é¢è¯•é€Ÿè®°<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/notebook/" aria-label="ğŸ«µç¬”è®°æœ¬"><FontIcon icon="book"></FontIcon>ğŸ«µç¬”è®°æœ¬<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/algorithm/" aria-label="ğŸ§®ç®—æ³•"><FontIcon icon="book"></FontIcon>ğŸ§®ç®—æ³•<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="ğŸ¤£ç½‘ç«™ç›¸å…³"><span class="title"><FontIcon icon="about"></FontIcon>ğŸ¤£ç½‘ç«™ç›¸å…³</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/about-the-author/" aria-label="å…³äºä½œè€…"><FontIcon icon="zuozhe"></FontIcon>å…³äºä½œè€…<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/timeline/" aria-label="æ›´æ–°å†å²"><FontIcon icon="history"></FontIcon>æ›´æ–°å†å²<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/HollowLatte/Note-Book" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><GitHubIcon style="width:1.25rem;height:1.25rem;vertical-align:middle;"></GitHubIcon></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">å¿…çœ‹</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="interview"></FontIcon><span class="vp-sidebar-title">é¢è¯•å‡†å¤‡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="java"></FontIcon><span class="vp-sidebar-title">Java</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><FontIcon icon="basic"></FontIcon><span class="vp-sidebar-title">åŸºç¡€</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/java-basic-questions-01.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)"><FontIcon></FontIcon>JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/java-basic-questions-02.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸­)"><FontIcon></FontIcon>JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸­)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/java-basic-questions-03.html" aria-label="JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)"><FontIcon></FontIcon>JavaåŸºç¡€å¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">é‡è¦çŸ¥è¯†ç‚¹</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/why-there-only-value-passing-in-java.html" aria-label="Java å€¼ä¼ é€’è¯¦è§£"><FontIcon></FontIcon>Java å€¼ä¼ é€’è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/serialization.html" aria-label="Java åºåˆ—åŒ–è¯¦è§£"><FontIcon></FontIcon>Java åºåˆ—åŒ–è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/generics-and-wildcards.html" aria-label="/java/basis/generics-and-wildcards.html"><FontIcon></FontIcon>/java/basis/generics-and-wildcards.html<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/reflection.html" aria-label="Java åå°„æœºåˆ¶è¯¦è§£"><FontIcon></FontIcon>Java åå°„æœºåˆ¶è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/proxy.html" aria-label="Java ä»£ç†æ¨¡å¼è¯¦è§£"><FontIcon></FontIcon>Java ä»£ç†æ¨¡å¼è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/bigdecimal.html" aria-label="BigDecimal è¯¦è§£"><FontIcon></FontIcon>BigDecimal è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/unsafe.html" aria-label="Java é­”æ³•ç±» Unsafe è¯¦è§£"><FontIcon></FontIcon>Java é­”æ³•ç±» Unsafe è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!----></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/basis/syntactic-sugar.html" aria-label="Java è¯­æ³•ç³–è¯¦è§£"><FontIcon></FontIcon>Java è¯­æ³•ç³–è¯¦è§£<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="container"></FontIcon><span class="vp-sidebar-title">é›†åˆ</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/collection/java-collection-questions-01.html" aria-label="Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)"><FontIcon></FontIcon>Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸Š)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/collection/java-collection-questions-02.html" aria-label="Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)"><FontIcon></FontIcon>Javaé›†åˆå¸¸è§é¢è¯•é¢˜æ€»ç»“(ä¸‹)<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/collection/java-collection-precautions-for-use.html" aria-label="Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“"><FontIcon></FontIcon>Javaé›†åˆä½¿ç”¨æ³¨æ„äº‹é¡¹æ€»ç»“<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">æºç åˆ†æ</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="et-performance"></FontIcon><span class="vp-sidebar-title">å¹¶å‘ç¼–ç¨‹</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/concurrent/java-concurrent-questions-01.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰"><FontIcon></FontIcon>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸Šï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/concurrent/java-concurrent-questions-02.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰"><FontIcon></FontIcon>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸­ï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/java/concurrent/java-concurrent-questions-03.html" aria-label="Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰"><FontIcon></FontIcon>Javaå¹¶å‘å¸¸è§é¢è¯•é¢˜æ€»ç»“ï¼ˆä¸‹ï¼‰<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">é‡è¦çŸ¥è¯†ç‚¹</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="code"></FontIcon><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="virtual_machine"></FontIcon><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="featured"></FontIcon><span class="vp-sidebar-title">æ–°ç‰¹æ€§</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="computer"></FontIcon><span class="vp-sidebar-title">è®¡ç®—æœºåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="database"></FontIcon><span class="vp-sidebar-title">æ•°æ®åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="tool"></FontIcon><span class="vp-sidebar-title">å¼€å‘å·¥å…·</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="component"></FontIcon><span class="vp-sidebar-title">å¸¸ç”¨æ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="design"></FontIcon><span class="vp-sidebar-title">ç³»ç»Ÿè®¾è®¡</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="distributed-network"></FontIcon><span class="vp-sidebar-title">åˆ†å¸ƒå¼</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="et-performance"></FontIcon><span class="vp-sidebar-title">é«˜æ€§èƒ½</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="highavailable"></FontIcon><span class="vp-sidebar-title">é«˜å¯ç”¨</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><FontIcon></FontIcon>Java SPI æœºåˆ¶è¯¦è§£</h1><div class="page-info"><AuthorInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></AuthorInfo><CategoryInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></CategoryInfo><TagInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></TagInfo><DateInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></DateInfo><OriginalInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></OriginalInfo><WordInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></WordInfo><ReadingTimeInfo localizeddate="2024å¹´3æœˆ26æ—¥" isoriginal="false" pageview="true" pure="true"></ReadingTimeInfo></div><hr></div><!----><!--[--><!----><!--]--><div class="theme-hope-content"><blockquote><p>æœ¬æ–‡æ¥è‡ª <a href="https://github.com/jjx0708" target="_blank" rel="noopener noreferrer">Kingshion<!----></a> æŠ•ç¨¿ã€‚æ¬¢è¿æ›´å¤šæœ‹å‹å‚ä¸åˆ° JavaGuide çš„ç»´æŠ¤å·¥ä½œï¼Œè¿™æ˜¯ä¸€ä»¶éå¸¸æœ‰æ„ä¹‰çš„äº‹æƒ…ã€‚è¯¦ç»†ä¿¡æ¯è¯·çœ‹ï¼š<a href="https://javaguide.cn/javaguide/contribution-guideline.html" target="_blank" rel="noopener noreferrer">JavaGuide è´¡çŒ®æŒ‡å—<!----></a> ã€‚</p></blockquote><p>åœ¨é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä¸­ï¼Œä¸€èˆ¬æ¨èæ¨¡å—ä¹‹é—´åŸºäºæ¥å£ç¼–ç¨‹ï¼Œé€šå¸¸æƒ…å†µä¸‹è°ƒç”¨æ–¹æ¨¡å—æ˜¯ä¸ä¼šæ„ŸçŸ¥åˆ°è¢«è°ƒç”¨æ–¹æ¨¡å—çš„å†…éƒ¨å…·ä½“å®ç°ã€‚ä¸€æ—¦ä»£ç é‡Œé¢æ¶‰åŠå…·ä½“å®ç°ç±»ï¼Œå°±è¿åäº†å¼€é—­åŸåˆ™ã€‚å¦‚æœéœ€è¦æ›¿æ¢ä¸€ç§å®ç°ï¼Œå°±éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p><p>ä¸ºäº†å®ç°åœ¨æ¨¡å—è£…é…çš„æ—¶å€™ä¸ç”¨åœ¨ç¨‹åºé‡Œé¢åŠ¨æ€æŒ‡æ˜ï¼Œè¿™å°±éœ€è¦ä¸€ç§æœåŠ¡å‘ç°æœºåˆ¶ã€‚Java SPI å°±æ˜¯æä¾›äº†è¿™æ ·ä¸€ä¸ªæœºåˆ¶ï¼š<strong>ä¸ºæŸä¸ªæ¥å£å¯»æ‰¾æœåŠ¡å®ç°çš„æœºåˆ¶ã€‚è¿™æœ‰ç‚¹ç±»ä¼¼ IoC çš„æ€æƒ³ï¼Œå°†è£…é…çš„æ§åˆ¶æƒç§»äº¤åˆ°äº†ç¨‹åºä¹‹å¤–ã€‚</strong></p><h2 id="spi-ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#spi-ä»‹ç»"><span>SPI ä»‹ç»</span></a></h2><h3 id="ä½•è°“-spi" tabindex="-1"><a class="header-anchor" href="#ä½•è°“-spi"><span>ä½•è°“ SPI?</span></a></h3><p>SPI å³ Service Provider Interface ï¼Œå­—é¢æ„æ€å°±æ˜¯ï¼šâ€œæœåŠ¡æä¾›è€…çš„æ¥å£â€ï¼Œæˆ‘çš„ç†è§£æ˜¯ï¼šä¸“é—¨æä¾›ç»™æœåŠ¡æä¾›è€…æˆ–è€…æ‰©å±•æ¡†æ¶åŠŸèƒ½çš„å¼€å‘è€…å»ä½¿ç”¨çš„ä¸€ä¸ªæ¥å£ã€‚</p><p>SPI å°†æœåŠ¡æ¥å£å’Œå…·ä½“çš„æœåŠ¡å®ç°åˆ†ç¦»å¼€æ¥ï¼Œå°†æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°è€…è§£è€¦ï¼Œèƒ½å¤Ÿæå‡ç¨‹åºçš„æ‰©å±•æ€§ã€å¯ç»´æŠ¤æ€§ã€‚ä¿®æ”¹æˆ–è€…æ›¿æ¢æœåŠ¡å®ç°å¹¶ä¸éœ€è¦ä¿®æ”¹è°ƒç”¨æ–¹ã€‚</p><p>å¾ˆå¤šæ¡†æ¶éƒ½ä½¿ç”¨äº† Java çš„ SPI æœºåˆ¶ï¼Œæ¯”å¦‚ï¼šSpring æ¡†æ¶ã€æ•°æ®åº“åŠ è½½é©±åŠ¨ã€æ—¥å¿—æ¥å£ã€ä»¥åŠ Dubbo çš„æ‰©å±•å®ç°ç­‰ç­‰ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/22e1830e0b0e4115a882751f6c417857tplv-k3u1fbpfcp-zoom-1.jpeg" alt="" tabindex="0"><figcaption></figcaption></figure><h3 id="spi-å’Œ-api-æœ‰ä»€ä¹ˆåŒºåˆ«" tabindex="-1"><a class="header-anchor" href="#spi-å’Œ-api-æœ‰ä»€ä¹ˆåŒºåˆ«"><span>SPI å’Œ API æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</span></a></h3><p><strong>é‚£ SPI å’Œ API æœ‰å•¥åŒºåˆ«ï¼Ÿ</strong></p><p>è¯´åˆ° SPI å°±ä¸å¾—ä¸è¯´ä¸€ä¸‹ API äº†ï¼Œä»å¹¿ä¹‰ä¸Šæ¥è¯´å®ƒä»¬éƒ½å±äºæ¥å£ï¼Œè€Œä¸”å¾ˆå®¹æ˜“æ··æ·†ã€‚ä¸‹é¢å…ˆç”¨ä¸€å¼ å›¾è¯´æ˜ä¸€ä¸‹ï¼š</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/1ebd1df862c34880bc26b9d494535b3dtplv-k3u1fbpfcp-watermark.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>ä¸€èˆ¬æ¨¡å—ä¹‹é—´éƒ½æ˜¯é€šè¿‡é€šè¿‡æ¥å£è¿›è¡Œé€šè®¯ï¼Œé‚£æˆ‘ä»¬åœ¨æœåŠ¡è°ƒç”¨æ–¹å’ŒæœåŠ¡å®ç°æ–¹ï¼ˆä¹Ÿç§°æœåŠ¡æä¾›è€…ï¼‰ä¹‹é—´å¼•å…¥ä¸€ä¸ªâ€œæ¥å£â€ã€‚</p><p>å½“å®ç°æ–¹æä¾›äº†æ¥å£å’Œå®ç°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨å®ç°æ–¹çš„æ¥å£ä»è€Œæ‹¥æœ‰å®ç°æ–¹ç»™æˆ‘ä»¬æä¾›çš„èƒ½åŠ›ï¼Œè¿™å°±æ˜¯ API ï¼Œè¿™ç§æ¥å£å’Œå®ç°éƒ½æ˜¯æ”¾åœ¨å®ç°æ–¹çš„ã€‚</p><p>å½“æ¥å£å­˜åœ¨äºè°ƒç”¨æ–¹è¿™è¾¹æ—¶ï¼Œå°±æ˜¯ SPI ï¼Œç”±æ¥å£è°ƒç”¨æ–¹ç¡®å®šæ¥å£è§„åˆ™ï¼Œç„¶åç”±ä¸åŒçš„å‚å•†å»æ ¹æ®è¿™ä¸ªè§„åˆ™å¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ï¼Œä»è€Œæä¾›æœåŠ¡ã€‚</p><p>ä¸¾ä¸ªé€šä¿—æ˜“æ‡‚çš„ä¾‹å­ï¼šå…¬å¸ H æ˜¯ä¸€å®¶ç§‘æŠ€å…¬å¸ï¼Œæ–°è®¾è®¡äº†ä¸€æ¬¾èŠ¯ç‰‡ï¼Œç„¶åç°åœ¨éœ€è¦é‡äº§äº†ï¼Œè€Œå¸‚é¢ä¸Šæœ‰å¥½å‡ å®¶èŠ¯ç‰‡åˆ¶é€ ä¸šå…¬å¸ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåªè¦ H å…¬å¸æŒ‡å®šå¥½äº†è¿™èŠ¯ç‰‡ç”Ÿäº§çš„æ ‡å‡†ï¼ˆå®šä¹‰å¥½äº†æ¥å£æ ‡å‡†ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›åˆä½œçš„èŠ¯ç‰‡å…¬å¸ï¼ˆæœåŠ¡æä¾›è€…ï¼‰å°±æŒ‰ç…§æ ‡å‡†äº¤ä»˜è‡ªå®¶ç‰¹è‰²çš„èŠ¯ç‰‡ï¼ˆæä¾›ä¸åŒæ–¹æ¡ˆçš„å®ç°ï¼Œä½†æ˜¯ç»™å‡ºæ¥çš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼‰ã€‚</p><h2 id="å®æˆ˜æ¼”ç¤º" tabindex="-1"><a class="header-anchor" href="#å®æˆ˜æ¼”ç¤º"><span>å®æˆ˜æ¼”ç¤º</span></a></h2><p>SLF4J ï¼ˆSimple Logging Facade for Javaï¼‰æ˜¯ Java çš„ä¸€ä¸ªæ—¥å¿—é—¨é¢ï¼ˆæ¥å£ï¼‰ï¼Œå…¶å…·ä½“å®ç°æœ‰å‡ ç§ï¼Œæ¯”å¦‚ï¼šLogbackã€Log4jã€Log4j2 ç­‰ç­‰ï¼Œè€Œä¸”è¿˜å¯ä»¥åˆ‡æ¢ï¼Œåœ¨åˆ‡æ¢æ—¥å¿—å…·ä½“å®ç°çš„æ—¶å€™æˆ‘ä»¬æ˜¯ä¸éœ€è¦æ›´æ”¹é¡¹ç›®ä»£ç çš„ï¼Œåªéœ€è¦åœ¨ Maven ä¾èµ–é‡Œé¢ä¿®æ”¹ä¸€äº› pom ä¾èµ–å°±å¥½äº†ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/image-20220723213306039-165858318917813.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>è¿™å°±æ˜¯ä¾èµ– SPI æœºåˆ¶å®ç°çš„ï¼Œé‚£æˆ‘ä»¬æ¥ä¸‹æ¥å°±å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„æ—¥å¿—æ¡†æ¶ã€‚</p><h3 id="service-provider-interface" tabindex="-1"><a class="header-anchor" href="#service-provider-interface"><span>Service Provider Interface</span></a></h3><p>æ–°å»ºä¸€ä¸ª Java é¡¹ç›® <code>service-provider-interface</code> ç›®å½•ç»“æ„å¦‚ä¸‹ï¼šï¼ˆæ³¨æ„ç›´æ¥æ–°å»º Java é¡¹ç›®å°±å¥½äº†ï¼Œä¸ç”¨æ–°å»º Maven é¡¹ç›®ï¼ŒMaven é¡¹ç›®ä¼šæ¶‰åŠåˆ°ä¸€äº›ç¼–è¯‘é…ç½®ï¼Œå¦‚æœæœ‰ç§æœçš„è¯ï¼Œç›´æ¥ deploy ä¼šæ¯”è¾ƒæ–¹ä¾¿ï¼Œä½†æ˜¯æ²¡æœ‰çš„è¯ï¼Œåœ¨è¿‡ç¨‹ä¸­å¯èƒ½ä¼šé‡åˆ°ä¸€äº›å¥‡æ€ªçš„é—®é¢˜ã€‚ï¼‰</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>â”‚  service-provider-interface.iml
â”‚
â”œâ”€.idea
â”‚  â”‚  .gitignore
â”‚  â”‚  misc.xml
â”‚  â”‚  modules.xml
â”‚  â””â”€ workspace.xml
â”‚
â””â”€src
    â””â”€edu
        â””â”€jiangxuan
            â””â”€up
                â””â”€spi
                        Logger.java
                        LoggerService.java
                        Main.class
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°å»º <code>Logger</code> æ¥å£ï¼Œè¿™ä¸ªå°±æ˜¯ SPI ï¼Œ æœåŠ¡æä¾›è€…æ¥å£ï¼Œåé¢çš„æœåŠ¡æä¾›è€…å°±è¦é’ˆå¯¹è¿™ä¸ªæ¥å£è¿›è¡Œå®ç°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>spi</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ¥ä¸‹æ¥å°±æ˜¯ <code>LoggerService</code> ç±»ï¼Œè¿™ä¸ªä¸»è¦æ˜¯ä¸ºæœåŠ¡ä½¿ç”¨è€…ï¼ˆè°ƒç”¨æ–¹ï¼‰æä¾›ç‰¹å®šåŠŸèƒ½çš„ã€‚è¿™ä¸ªç±»ä¹Ÿæ˜¯å®ç° Java SPI æœºåˆ¶çš„å…³é”®æ‰€åœ¨ï¼Œå¦‚æœå­˜åœ¨ç–‘æƒ‘çš„è¯å¯ä»¥å…ˆå¾€åé¢ç»§ç»­çœ‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>spi</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ServiceLoader</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoggerService</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">LoggerService</span> <span class="token constant">SERVICE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LoggerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Logger</span> logger<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Logger</span><span class="token punctuation">&gt;</span></span> loggerList<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">LoggerService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Logger</span><span class="token punctuation">&gt;</span></span> loader <span class="token operator">=</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Logger</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Logger</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Logger</span> log <span class="token operator">:</span> loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// LoggerList æ˜¯æ‰€æœ‰ ServiceProvider</span>
        loggerList <span class="token operator">=</span> list<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>list<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Logger åªå–ä¸€ä¸ª</span>
            logger <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            logger <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LoggerService</span> <span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token constant">SERVICE</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>logger <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;info ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">String</span> msg<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>loggerList<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;debug ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        loggerList<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>log <span class="token operator">-&gt;</span> log<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span>msg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°å»º <code>Main</code> ç±»ï¼ˆæœåŠ¡ä½¿ç”¨è€…ï¼Œè°ƒç”¨æ–¹ï¼‰ï¼Œå¯åŠ¨ç¨‹åºæŸ¥çœ‹ç»“æœã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">org<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LoggerService</span> service <span class="token operator">=</span> <span class="token class-name">LoggerService</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        service<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;Hello SPI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        service<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;Hello SPI&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¨‹åºç»“æœï¼š</p><blockquote><p>info ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€… debug ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…</p></blockquote><p>æ­¤æ—¶æˆ‘ä»¬åªæ˜¯ç©ºæœ‰æ¥å£ï¼Œå¹¶æ²¡æœ‰ä¸º <code>Logger</code> æ¥å£æä¾›ä»»ä½•çš„å®ç°ï¼Œæ‰€ä»¥è¾“å‡ºç»“æœä¸­æ²¡æœ‰æŒ‰ç…§é¢„æœŸæ‰“å°ç›¸åº”çš„ç»“æœã€‚</p><p>ä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤æˆ–è€…ç›´æ¥ä½¿ç”¨ IDEA å°†æ•´ä¸ªç¨‹åºç›´æ¥æ‰“åŒ…æˆ jar åŒ…ã€‚</p><h3 id="service-provider" tabindex="-1"><a class="header-anchor" href="#service-provider"><span>Service Provider</span></a></h3><p>æ¥ä¸‹æ¥æ–°å»ºä¸€ä¸ªé¡¹ç›®ç”¨æ¥å®ç° <code>Logger</code> æ¥å£</p><p>æ–°å»ºé¡¹ç›® <code>service-provider</code> ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>â”‚  service-provider.iml
â”‚
â”œâ”€.idea
â”‚  â”‚  .gitignore
â”‚  â”‚  misc.xml
â”‚  â”‚  modules.xml
â”‚  â””â”€ workspace.xml
â”‚
â”œâ”€lib
â”‚      service-provider-interface.jar
|
â””â”€src
    â”œâ”€edu
    â”‚  â””â”€jiangxuan
    â”‚      â””â”€up
    â”‚          â””â”€spi
    â”‚              â””â”€service
    â”‚                      Logback.java
    â”‚
    â””â”€META-INF
        â””â”€services
                edu.jiangxuan.up.spi.Logger

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ–°å»º <code>Logback</code> ç±»</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>spi<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">Logger</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Logback</span> <span class="token keyword">implements</span> <span class="token class-name">Logger</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">info</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Logback info æ‰“å°æ—¥å¿—ï¼š&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">debug</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Logback debug æ‰“å°æ—¥å¿—ï¼š&quot;</span> <span class="token operator">+</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°† <code>service-provider-interface</code> çš„ jar å¯¼å…¥é¡¹ç›®ä¸­ã€‚</p><p>æ–°å»º lib ç›®å½•ï¼Œç„¶åå°† jar åŒ…æ‹·è´è¿‡æ¥ï¼Œå†æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/523d5e25198444d3b112baf68ce49daetplv-k3u1fbpfcp-watermark.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>å†ç‚¹å‡» OK ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/f4ba0aa71e9b4d509b9159892a220850tplv-k3u1fbpfcp-watermark.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­å¯¼å…¥ jar åŒ…é‡Œé¢çš„ä¸€äº›ç±»å’Œæ–¹æ³•äº†ï¼Œå°±åƒ JDK å·¥å…·ç±»å¯¼åŒ…ä¸€æ ·çš„ã€‚</p><p>å®ç° <code>Logger</code> æ¥å£ï¼Œåœ¨ <code>src</code> ç›®å½•ä¸‹æ–°å»º <code>META-INF/services</code> æ–‡ä»¶å¤¹ï¼Œç„¶åæ–°å»ºæ–‡ä»¶ <code>edu.jiangxuan.up.spi.Logger</code> ï¼ˆSPI çš„å…¨ç±»åï¼‰ï¼Œæ–‡ä»¶é‡Œé¢çš„å†…å®¹æ˜¯ï¼š<code>edu.jiangxuan.up.spi.service.Logback</code> ï¼ˆLogback çš„å…¨ç±»åï¼Œå³ SPI çš„å®ç°ç±»çš„åŒ…å + ç±»åï¼‰ã€‚</p><p><strong>è¿™æ˜¯ JDK SPI æœºåˆ¶ ServiceLoader çº¦å®šå¥½çš„æ ‡å‡†ã€‚</strong></p><p>è¿™é‡Œå…ˆå¤§æ¦‚è§£é‡Šä¸€ä¸‹ï¼šJava ä¸­çš„ SPI æœºåˆ¶å°±æ˜¯åœ¨æ¯æ¬¡ç±»åŠ è½½çš„æ—¶å€™ä¼šå…ˆå»æ‰¾åˆ° class ç›¸å¯¹ç›®å½•ä¸‹çš„ <code>META-INF</code> æ–‡ä»¶å¤¹ä¸‹çš„ services æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶ï¼Œå°†è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢çš„æ‰€æœ‰æ–‡ä»¶å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åæ ¹æ®è¿™äº›æ–‡ä»¶çš„æ–‡ä»¶åå’Œé‡Œé¢çš„æ–‡ä»¶å†…å®¹æ‰¾åˆ°ç›¸åº”æ¥å£çš„å…·ä½“å®ç°ç±»ï¼Œæ‰¾åˆ°å®ç°ç±»åå°±å¯ä»¥é€šè¿‡åå°„å»ç”Ÿæˆå¯¹åº”çš„å¯¹è±¡ï¼Œä¿å­˜åœ¨ä¸€ä¸ª list åˆ—è¡¨é‡Œé¢ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡è¿­ä»£æˆ–è€…éå†çš„æ–¹å¼æ‹¿åˆ°å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œç”Ÿæˆä¸åŒçš„å®ç°ã€‚</p><p>æ‰€ä»¥ä¼šæå‡ºä¸€äº›è§„èŒƒè¦æ±‚ï¼šæ–‡ä»¶åä¸€å®šè¦æ˜¯æ¥å£çš„å…¨ç±»åï¼Œç„¶åé‡Œé¢çš„å†…å®¹ä¸€å®šè¦æ˜¯å®ç°ç±»çš„å…¨ç±»åï¼Œå®ç°ç±»å¯ä»¥æœ‰å¤šä¸ªï¼Œç›´æ¥æ¢è¡Œå°±å¥½äº†ï¼Œå¤šä¸ªå®ç°ç±»çš„æ—¶å€™ï¼Œä¼šä¸€ä¸ªä¸€ä¸ªçš„è¿­ä»£åŠ è½½ã€‚</p><p>æ¥ä¸‹æ¥åŒæ ·å°† <code>service-provider</code> é¡¹ç›®æ‰“åŒ…æˆ jar åŒ…ï¼Œè¿™ä¸ª jar åŒ…å°±æ˜¯æœåŠ¡æä¾›æ–¹çš„å®ç°ã€‚é€šå¸¸æˆ‘ä»¬å¯¼å…¥ maven çš„ pom ä¾èµ–å°±æœ‰ç‚¹ç±»ä¼¼è¿™ç§ï¼Œåªä¸è¿‡æˆ‘ä»¬ç°åœ¨æ²¡æœ‰å°†è¿™ä¸ª jar åŒ…å‘å¸ƒåˆ° maven å…¬å…±ä»“åº“ä¸­ï¼Œæ‰€ä»¥åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹åªèƒ½æ‰‹åŠ¨çš„æ·»åŠ åˆ°é¡¹ç›®ä¸­ã€‚</p><h3 id="æ•ˆæœå±•ç¤º" tabindex="-1"><a class="header-anchor" href="#æ•ˆæœå±•ç¤º"><span>æ•ˆæœå±•ç¤º</span></a></h3><p>ä¸ºäº†æ›´ç›´è§‚çš„å±•ç¤ºæ•ˆæœï¼Œæˆ‘è¿™é‡Œå†æ–°å»ºä¸€ä¸ªä¸“é—¨ç”¨æ¥æµ‹è¯•çš„å·¥ç¨‹é¡¹ç›®ï¼š<code>java-spi-test</code></p><p>ç„¶åå…ˆå¯¼å…¥ <code>Logger</code> çš„æ¥å£ jar åŒ…ï¼Œå†å¯¼å…¥å…·ä½“çš„å®ç°ç±»çš„ jar åŒ…ã€‚</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/basis/spi/image-20220723215812708-165858469599214.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>æ–°å»º Main æ–¹æ³•æµ‹è¯•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>spi<span class="token punctuation">.</span></span><span class="token class-name">LoggerService</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestJavaSPI</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">LoggerService</span> loggerService <span class="token operator">=</span> <span class="token class-name">LoggerService</span><span class="token punctuation">.</span><span class="token function">getService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loggerService<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">&quot;ä½ å¥½&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loggerService<span class="token punctuation">.</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">&quot;æµ‹è¯•Java SPI æœºåˆ¶&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><blockquote><p>Logback info æ‰“å°æ—¥å¿—ï¼šä½ å¥½ Logback debug æ‰“å°æ—¥å¿—ï¼šæµ‹è¯• Java SPI æœºåˆ¶</p></blockquote><p>è¯´æ˜å¯¼å…¥ jar åŒ…ä¸­çš„å®ç°ç±»ç”Ÿæ•ˆäº†ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸å¯¼å…¥å…·ä½“çš„å®ç°ç±»çš„ jar åŒ…ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¨‹åºè¿è¡Œçš„ç»“æœå°±ä¼šæ˜¯ï¼š</p><blockquote><p>info ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€… debug ä¸­æ²¡æœ‰å‘ç° Logger æœåŠ¡æä¾›è€…</p></blockquote><p>é€šè¿‡ä½¿ç”¨ SPI æœºåˆ¶ï¼Œå¯ä»¥çœ‹å‡ºæœåŠ¡ï¼ˆ<code>LoggerService</code>ï¼‰å’Œ æœåŠ¡æä¾›è€…ä¸¤è€…ä¹‹é—´çš„è€¦åˆåº¦éå¸¸ä½ï¼Œå¦‚æœè¯´æˆ‘ä»¬æƒ³è¦æ¢ä¸€ç§å®ç°ï¼Œé‚£ä¹ˆå…¶å®åªéœ€è¦ä¿®æ”¹ <code>service-provider</code> é¡¹ç›®ä¸­é’ˆå¯¹ <code>Logger</code> æ¥å£çš„å…·ä½“å®ç°å°±å¯ä»¥äº†ï¼Œåªéœ€è¦æ¢ä¸€ä¸ª jar åŒ…å³å¯ï¼Œä¹Ÿå¯ä»¥æœ‰åœ¨ä¸€ä¸ªé¡¹ç›®é‡Œé¢æœ‰å¤šä¸ªå®ç°ï¼Œè¿™ä¸å°±æ˜¯ SLF4J åŸç†å—ï¼Ÿ</p><p>å¦‚æœæŸä¸€å¤©éœ€æ±‚å˜æ›´äº†ï¼Œæ­¤æ—¶éœ€è¦å°†æ—¥å¿—è¾“å‡ºåˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæˆ–è€…åšä¸€äº›åˆ«çš„æ“ä½œï¼Œè¿™ä¸ªæ—¶å€™å®Œå…¨ä¸éœ€è¦æ›´æ”¹ Logback çš„å®ç°ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ªæœåŠ¡å®ç°ï¼ˆservice-providerï¼‰å¯ä»¥é€šè¿‡åœ¨æœ¬é¡¹ç›®é‡Œé¢æ–°å¢å®ç°ä¹Ÿå¯ä»¥ä»å¤–éƒ¨å¼•å…¥æ–°çš„æœåŠ¡å®ç° jar åŒ…ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æœåŠ¡(LoggerService)ä¸­é€‰æ‹©ä¸€ä¸ªå…·ä½“çš„ æœåŠ¡å®ç°(service-provider) æ¥å®Œæˆæˆ‘ä»¬éœ€è¦çš„æ“ä½œã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬å…·ä½“æ¥è¯´è¯´ Java SPI å·¥ä½œçš„é‡ç‚¹åŸç†â€”â€” <strong>ServiceLoader</strong> ã€‚</p><h2 id="serviceloader" tabindex="-1"><a class="header-anchor" href="#serviceloader"><span>ServiceLoader</span></a></h2><h3 id="serviceloader-å…·ä½“å®ç°" tabindex="-1"><a class="header-anchor" href="#serviceloader-å…·ä½“å®ç°"><span>ServiceLoader å…·ä½“å®ç°</span></a></h3><p>æƒ³è¦ä½¿ç”¨ Java çš„ SPI æœºåˆ¶æ˜¯éœ€è¦ä¾èµ– <code>ServiceLoader</code> æ¥å®ç°çš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹ <code>ServiceLoader</code> å…·ä½“æ˜¯æ€ä¹ˆåšçš„ï¼š</p><p><code>ServiceLoader</code> æ˜¯ JDK æä¾›çš„ä¸€ä¸ªå·¥å…·ç±»ï¼Œ ä½äº<code>package java.util;</code>åŒ…ä¸‹ã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>A facility to load implementations of a service.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿™æ˜¯ JDK å®˜æ–¹ç»™çš„æ³¨é‡Šï¼š<strong>ä¸€ç§åŠ è½½æœåŠ¡å®ç°çš„å·¥å…·ã€‚</strong></p><p>å†å¾€ä¸‹çœ‹ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªç±»æ˜¯ä¸€ä¸ª <code>final</code> ç±»å‹çš„ï¼Œæ‰€ä»¥æ˜¯ä¸å¯è¢«ç»§æ‰¿ä¿®æ”¹ï¼ŒåŒæ—¶å®ƒå®ç°äº† <code>Iterable</code> æ¥å£ã€‚ä¹‹æ‰€ä»¥å®ç°äº†è¿­ä»£å™¨ï¼Œæ˜¯ä¸ºäº†æ–¹ä¾¿åç»­æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡è¿­ä»£çš„æ–¹å¼å¾—åˆ°å¯¹åº”çš„æœåŠ¡å®ç°ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name">Iterable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span> xxx<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¯ä»¥çœ‹åˆ°ä¸€ä¸ªç†Ÿæ‚‰çš„å¸¸é‡å®šä¹‰ï¼š</p><p><code>private static final String PREFIX = &quot;META-INF/services/&quot;;</code></p><p>ä¸‹é¢æ˜¯ <code>load</code> æ–¹æ³•ï¼šå¯ä»¥å‘ç° <code>load</code> æ–¹æ³•æ”¯æŒä¸¤ç§é‡è½½åçš„å…¥å‚ï¼›</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ClassLoader</span> cl <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> cl<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">,</span>
                                        <span class="token class-name">ClassLoader</span> loader<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">ServiceLoader</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> svc<span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span> cl<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    service <span class="token operator">=</span> <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>svc<span class="token punctuation">,</span> <span class="token string">&quot;Service interface cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    loader <span class="token operator">=</span> <span class="token punctuation">(</span>cl <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> cl<span class="token punctuation">;</span>
    acc <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getSecurityManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    providers<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    lookupIterator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazyIterator</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ ¹æ®ä»£ç çš„è°ƒç”¨é¡ºåºï¼Œåœ¨ <code>reload()</code> æ–¹æ³•ä¸­æ˜¯é€šè¿‡ä¸€ä¸ªå†…éƒ¨ç±» <code>LazyIterator</code> å®ç°çš„ã€‚å…ˆç»§ç»­å¾€ä¸‹é¢çœ‹ã€‚</p><p><code>ServiceLoader</code> å®ç°äº† <code>Iterable</code> æ¥å£çš„æ–¹æ³•åï¼Œå…·æœ‰äº†è¿­ä»£çš„èƒ½åŠ›ï¼Œåœ¨è¿™ä¸ª <code>iterator</code> æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œé¦–å…ˆä¼šåœ¨ <code>ServiceLoader</code> çš„ <code>Provider</code> ç¼“å­˜ä¸­è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœç¼“å­˜ä¸­æ²¡æœ‰å‘½ä¸­é‚£ä¹ˆåˆ™åœ¨ <code>LazyIterator</code> ä¸­è¿›è¡ŒæŸ¥æ‰¾ã€‚</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">S</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> knownProviders
                <span class="token operator">=</span> providers<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>knownProviders<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> lookupIterator<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨ LazyIterator</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token class-name">S</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>knownProviders<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> knownProviders<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> lookupIterator<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è°ƒç”¨ LazyIterator</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨è°ƒç”¨ <code>LazyIterator</code> æ—¶ï¼Œå…·ä½“å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code>
<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>acc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span> action <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">Boolean</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nextName <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>configs <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">//é€šè¿‡PREFIXï¼ˆMETA-INF/services/ï¼‰å’Œç±»å è·å–å¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå¾—åˆ°å…·ä½“çš„å®ç°ç±»</span>
            <span class="token class-name">String</span> fullName <span class="token operator">=</span> <span class="token constant">PREFIX</span> <span class="token operator">+</span> service<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>loader <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                configs <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemResources</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                configs <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span>fullName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> <span class="token string">&quot;Error locating configuration files&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>pending <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>pending<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>configs<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        pending <span class="token operator">=</span> <span class="token function">parse</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span> configs<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    nextName <span class="token operator">=</span> pending<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">public</span> <span class="token class-name">S</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>acc <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">nextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> action <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">public</span> <span class="token class-name">S</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token function">nextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span>action<span class="token punctuation">,</span> acc<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> <span class="token class-name">S</span> <span class="token function">nextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">hasNextService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NoSuchElementException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> cn <span class="token operator">=</span> nextName<span class="token punctuation">;</span>
    nextName <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> c <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        c <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cn<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> loader<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
                <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn <span class="token operator">+</span> <span class="token string">&quot; not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>service<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
                <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn <span class="token operator">+</span> <span class="token string">&quot; not a subtype&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token class-name">S</span> p <span class="token operator">=</span> service<span class="token punctuation">.</span><span class="token function">cast</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        providers<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>cn<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fail</span><span class="token punctuation">(</span>service<span class="token punctuation">,</span>
                <span class="token string">&quot;Provider &quot;</span> <span class="token operator">+</span> cn <span class="token operator">+</span> <span class="token string">&quot; could not be instantiated&quot;</span><span class="token punctuation">,</span>
                x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// This cannot happen</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯èƒ½å¾ˆå¤šäººçœ‹è¿™ä¸ªä¼šè§‰å¾—æœ‰ç‚¹å¤æ‚ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘è¿™è¾¹å®ç°äº†ä¸€ä¸ªç®€å•çš„ <code>ServiceLoader</code> çš„å°æ¨¡å‹ï¼Œæµç¨‹å’ŒåŸç†éƒ½æ˜¯ä¿æŒä¸€è‡´çš„ï¼Œå¯ä»¥å…ˆä»è‡ªå·±å®ç°ä¸€ä¸ªç®€æ˜“ç‰ˆæœ¬çš„å¼€å§‹å­¦ï¼š</p><h3 id="è‡ªå·±å®ç°ä¸€ä¸ª-serviceloader" tabindex="-1"><a class="header-anchor" href="#è‡ªå·±å®ç°ä¸€ä¸ª-serviceloader"><span>è‡ªå·±å®ç°ä¸€ä¸ª ServiceLoader</span></a></h3><p>æˆ‘å…ˆæŠŠä»£ç è´´å‡ºæ¥ï¼š</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">edu<span class="token punctuation">.</span>jiangxuan<span class="token punctuation">.</span>up<span class="token punctuation">.</span>service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">BufferedReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStreamReader</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Constructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLConnection</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">ArrayList</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Enumeration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">List</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token comment">// å¯¹åº”çš„æ¥å£ Class æ¨¡æ¿</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">;</span>

    <span class="token comment">// å¯¹åº”å®ç°ç±»çš„ å¯ä»¥æœ‰å¤šä¸ªï¼Œç”¨ List è¿›è¡Œå°è£…</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> providers <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// ç±»åŠ è½½å™¨</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ClassLoader</span> classLoader<span class="token punctuation">;</span>

    <span class="token comment">// æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨çš„æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¯ä»¥å¼€å§‹åŠ è½½è‡ªå·±å®šåˆ¶çš„å®ç°æµç¨‹ã€‚</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">MyServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyServiceLoader</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>service<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ„é€ æ–¹æ³•ç§æœ‰åŒ–</span>
    <span class="token keyword">private</span> <span class="token class-name">MyServiceLoader</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> service<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>service <span class="token operator">=</span> service<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">doLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// å…³é”®æ–¹æ³•ï¼ŒåŠ è½½å…·ä½“å®ç°ç±»çš„é€»è¾‘</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">doLoad</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¯»å–æ‰€æœ‰ jar åŒ…é‡Œé¢ META-INF/services åŒ…ä¸‹é¢çš„æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶åå°±æ˜¯æ¥å£åï¼Œç„¶åæ–‡ä»¶é‡Œé¢çš„å†…å®¹å°±æ˜¯å…·ä½“çš„å®ç°ç±»çš„è·¯å¾„åŠ å…¨ç±»å</span>
            <span class="token class-name">Enumeration</span><span class="token generics"><span class="token punctuation">&lt;</span>URL<span class="token punctuation">&gt;</span></span> urls <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token string">&quot;META-INF/services/&quot;</span> <span class="token operator">+</span> service<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// æŒ¨ä¸ªéå†å–åˆ°çš„æ–‡ä»¶</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>urls<span class="token punctuation">.</span><span class="token function">hasMoreElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// å–å‡ºå½“å‰çš„æ–‡ä»¶</span>
                <span class="token class-name">URL</span> url <span class="token operator">=</span> urls<span class="token punctuation">.</span><span class="token function">nextElement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;File = &quot;</span> <span class="token operator">+</span> url<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// å»ºç«‹é“¾æ¥</span>
                <span class="token class-name">URLConnection</span> urlConnection <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                urlConnection<span class="token punctuation">.</span><span class="token function">setUseCaches</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è·å–æ–‡ä»¶è¾“å…¥æµ</span>
                <span class="token class-name">InputStream</span> inputStream <span class="token operator">=</span> urlConnection<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ä»æ–‡ä»¶è¾“å…¥æµè·å–ç¼“å­˜</span>
                <span class="token class-name">BufferedReader</span> bufferedReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>inputStream<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// ä»æ–‡ä»¶å†…å®¹é‡Œé¢å¾—åˆ°å®ç°ç±»çš„å…¨ç±»å</span>
                <span class="token class-name">String</span> className <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token keyword">while</span> <span class="token punctuation">(</span>className <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// é€šè¿‡åå°„æ‹¿åˆ°å®ç°ç±»çš„å®ä¾‹</span>
                    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// å¦‚æœå£°æ˜çš„æ¥å£è·Ÿè¿™ä¸ªå…·ä½“çš„å®ç°ç±»æ˜¯å±äºåŒä¸€ç±»å‹ï¼Œï¼ˆå¯ä»¥ç†è§£ä¸ºJavaçš„ä¸€ç§å¤šæ€ï¼Œæ¥å£è·Ÿå®ç°ç±»ã€çˆ¶ç±»å’Œå­ç±»ç­‰ç­‰è¿™ç§å…³ç³»ã€‚ï¼‰åˆ™æ„é€ å®ä¾‹</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>service<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> constructor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Constructor</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">S</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> clazz<span class="token punctuation">.</span><span class="token function">getConstructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token class-name">S</span> instance <span class="token operator">=</span> constructor<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// æŠŠå½“å‰æ„é€ çš„å®ä¾‹å¯¹è±¡æ·»åŠ åˆ° Providerçš„åˆ—è¡¨é‡Œé¢</span>
                        providers<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token comment">// ç»§ç»­è¯»å–ä¸‹ä¸€è¡Œçš„å®ç°ç±»ï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ç°ç±»ï¼Œåªéœ€è¦æ¢è¡Œå°±å¯ä»¥äº†ã€‚</span>
                    className <span class="token operator">=</span> bufferedReader<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯»å–æ–‡ä»¶å¼‚å¸¸ã€‚ã€‚ã€‚&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// è¿”å›spiæ¥å£å¯¹åº”çš„å…·ä½“å®ç°ç±»åˆ—è¡¨</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">S</span><span class="token punctuation">&gt;</span></span> <span class="token function">getProviders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> providers<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å…³é”®ä¿¡æ¯åŸºæœ¬å·²ç»é€šè¿‡ä»£ç æ³¨é‡Šæè¿°å‡ºæ¥äº†ï¼Œ</p><p>ä¸»è¦çš„æµç¨‹å°±æ˜¯ï¼š</p><ol><li>é€šè¿‡ URL å·¥å…·ç±»ä» jar åŒ…çš„ <code>/META-INF/services</code> ç›®å½•ä¸‹é¢æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼Œ</li><li>è¯»å–è¿™ä¸ªæ–‡ä»¶çš„åç§°æ‰¾åˆ°å¯¹åº”çš„ spi æ¥å£ï¼Œ</li><li>é€šè¿‡ <code>InputStream</code> æµå°†æ–‡ä»¶é‡Œé¢çš„å…·ä½“å®ç°ç±»çš„å…¨ç±»åè¯»å–å‡ºæ¥ï¼Œ</li><li>æ ¹æ®è·å–åˆ°çš„å…¨ç±»åï¼Œå…ˆåˆ¤æ–­è·Ÿ spi æ¥å£æ˜¯å¦ä¸ºåŒä¸€ç±»å‹ï¼Œå¦‚æœæ˜¯çš„ï¼Œé‚£ä¹ˆå°±é€šè¿‡åå°„çš„æœºåˆ¶æ„é€ å¯¹åº”çš„å®ä¾‹å¯¹è±¡ï¼Œ</li><li>å°†æ„é€ å‡ºæ¥çš„å®ä¾‹å¯¹è±¡æ·»åŠ åˆ° <code>Providers</code> çš„åˆ—è¡¨ä¸­ã€‚</li></ol><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>å…¶å®ä¸éš¾å‘ç°ï¼ŒSPI æœºåˆ¶çš„å…·ä½“å®ç°æœ¬è´¨ä¸Šè¿˜æ˜¯é€šè¿‡åå°„å®Œæˆçš„ã€‚å³ï¼š<strong>æˆ‘ä»¬æŒ‰ç…§è§„å®šå°†è¦æš´éœ²å¯¹å¤–ä½¿ç”¨çš„å…·ä½“å®ç°ç±»åœ¨ <code>META-INF/services/</code> æ–‡ä»¶ä¸‹å£°æ˜ã€‚</strong></p><p>å¦å¤–ï¼ŒSPI æœºåˆ¶åœ¨å¾ˆå¤šæ¡†æ¶ä¸­éƒ½æœ‰åº”ç”¨ï¼šSpring æ¡†æ¶çš„åŸºæœ¬åŸç†ä¹Ÿæ˜¯ç±»ä¼¼çš„æ–¹å¼ã€‚è¿˜æœ‰ Dubbo æ¡†æ¶æä¾›åŒæ ·çš„ SPI æ‰©å±•æœºåˆ¶ï¼Œåªä¸è¿‡ Dubbo å’Œ spring æ¡†æ¶ä¸­çš„ SPI æœºåˆ¶å…·ä½“å®ç°æ–¹å¼è·Ÿå’±ä»¬ä»Šå¤©å­¦å¾—è¿™ä¸ªæœ‰äº›ç»†å¾®çš„åŒºåˆ«ï¼Œä¸è¿‡æ•´ä½“çš„åŸç†éƒ½æ˜¯ä¸€è‡´çš„ï¼Œç›¸ä¿¡å¤§å®¶é€šè¿‡å¯¹ JDK ä¸­ SPI æœºåˆ¶çš„å­¦ä¹ ï¼Œèƒ½å¤Ÿä¸€é€šç™¾é€šï¼ŒåŠ æ·±å¯¹å…¶ä»–é«˜æ·±æ¡†çš„ç†è§£ã€‚</p><p>é€šè¿‡ SPI æœºåˆ¶èƒ½å¤Ÿå¤§å¤§åœ°æé«˜æ¥å£è®¾è®¡çš„çµæ´»æ€§ï¼Œä½†æ˜¯ SPI æœºåˆ¶ä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ï¼š</p><ol><li>éå†åŠ è½½æ‰€æœ‰çš„å®ç°ç±»ï¼Œè¿™æ ·æ•ˆç‡è¿˜æ˜¯ç›¸å¯¹è¾ƒä½çš„ï¼›</li><li>å½“å¤šä¸ª <code>ServiceLoader</code> åŒæ—¶ <code>load</code> æ—¶ï¼Œä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚</li></ol></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/HollowLatte/Note-Book/edit/main/docs/java/basis/spi.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: hollowlatte@outlook.com">hollowlatte</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/Note-Book/java/basis/unsafe.html" aria-label="Java é­”æ³•ç±» Unsafe è¯¦è§£"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><FontIcon></FontIcon>Java é­”æ³•ç±» Unsafe è¯¦è§£</div></a><a class="route-link nav-link next" href="/Note-Book/java/basis/syntactic-sugar.html" aria-label="Java è¯­æ³•ç³–è¯¦è§£"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">Java è¯­æ³•ç³–è¯¦è§£<FontIcon></FontIcon></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">é„‚ICPå¤‡2020015769å·-1</a></div><div class="vp-copyright">Copyright Â© 2024 Hollow-Latte </div></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/Note-Book/assets/app-4HbIzINy.js" defer></script>
  </body>
</html>

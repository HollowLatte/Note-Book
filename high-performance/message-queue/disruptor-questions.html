<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.6" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.22" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://hollowlatte.github.io/Note-Book/Note-Book/high-performance/message-queue/disruptor-questions.html"><meta property="og:site_name" content="Note-Book"><meta property="og:title" content="Disruptor常见问题总结"><meta property="og:description" content="Disruptor 是一个相对冷门一些的知识点，不过，如果你的项目经历中用到了 Disruptor 的话，那面试中就很可能会被问到。 一位球友之前投稿的面经（社招）中就涉及一些 Disruptor 的问题，文章传送门：圆梦！顺利拿到字节、淘宝、拼多多等大厂 offer！ 。 这篇文章可以看作是对 Disruptor 做的一个简单总结，每个问题都不会扯太..."><meta property="og:type" content="article"><meta property="og:image" content="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-interview-questions.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-03-21T15:09:08.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="Disruptor常见问题总结"><meta property="article:author" content="Hollow-Latte"><meta property="article:tag" content="消息队列"><meta property="article:modified_time" content="2024-03-21T15:09:08.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Disruptor常见问题总结","image":["https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-interview-questions.png","https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/640.png","https://oss.javaguide.cn/javaguide/image-20211015152323898.png","https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-latency-histogram.png","https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-models.png","https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/DisruptorWaitStrategy.png","https://oss.javaguide.cn/github/javaguide/java/concurrent/cpu-cache.png"],"dateModified":"2024-03-21T15:09:08.000Z","author":[{"@type":"Person","name":"Hollow-Latte","url":"https://hollowlatte.github.io/Note-Book"}]}</script><meta name="robots" content="all"><meta name="author" content="Guide"><meta name="referrer" content="no-referrer"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="keywords" content="Java基础, 多线程, JVM, 虚拟机, 数据库, MySQL, Spring, Redis, MyBatis, 系统设计, 分布式, RPC, 高可用, 高并发"><meta name="apple-mobile-web-app-capable" content="yes"><script>var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?5dd2e8c97962d57b7b8fea1737c01743";
          var s = document.getElementsByTagName("script")[0]; 
          s.parentNode.insertBefore(hm, s);
        })();</script><link ref="preconnect" href="https://fonts.googleapis.com"><link ref="preconnect" href="https://fonts.gstatic.com" crossorigin=""><link ref="stylesheet" href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap"><link rel="alternate" type="application/atom+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/atom.xml" title="Note-Book Atom Feed"><link rel="alternate" type="application/json" href="https://hollowlatte.github.io/Note-Book/Note-Book/feed.json" title="Note-Book JSON Feed"><link rel="alternate" type="application/rss+xml" href="https://hollowlatte.github.io/Note-Book/Note-Book/rss.xml" title="Note-Book RSS Feed"><link rel="icon" href="/Note-Book/favicon.ico"><title>Disruptor常见问题总结 | Note-Book</title><meta name="description" content="Disruptor 是一个相对冷门一些的知识点，不过，如果你的项目经历中用到了 Disruptor 的话，那面试中就很可能会被问到。 一位球友之前投稿的面经（社招）中就涉及一些 Disruptor 的问题，文章传送门：圆梦！顺利拿到字节、淘宝、拼多多等大厂 offer！ 。 这篇文章可以看作是对 Disruptor 做的一个简单总结，每个问题都不会扯太...">
    <link rel="preload" href="/Note-Book/assets/style-bCPtHIxr.css" as="style"><link rel="stylesheet" href="/Note-Book/assets/style-bCPtHIxr.css">
    <link rel="modulepreload" href="/Note-Book/assets/app-CDroZFTS.js"><link rel="modulepreload" href="/Note-Book/assets/disruptor-questions.html-CYjeCY6K.js"><link rel="modulepreload" href="/Note-Book/assets/plugin-vue_export-helper-DlAUqK2U.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="route-link vp-brand" href="/Note-Book/"><img class="vp-nav-logo" src="/Note-Book/logo.png" alt><!----><span class="vp-site-name hide-in-pad">Note-Book</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/home.html" aria-label="面试指南"><FontIcon icon="java"></FontIcon>面试指南<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="🧐研究"><span class="title"><FontIcon></FontIcon>🧐研究</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/open-source-project/" aria-label="开源项目"><FontIcon icon="github"></FontIcon>开源项目<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/research/interesting/" aria-label="好玩的"><FontIcon icon="github"></FontIcon>好玩的<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/business/" aria-label="😋业务"><FontIcon></FontIcon>😋业务<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/practice-manual/" aria-label="😎实践手册"><FontIcon icon="about"></FontIcon>😎实践手册<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="😰问题集合"><span class="title"><FontIcon></FontIcon>😰问题集合</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/backend-problem/" aria-label="后端问题"><FontIcon icon="github"></FontIcon>后端问题<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/frontend-problem/" aria-label="前端问题"><FontIcon icon="github"></FontIcon>前端问题<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/problem/non-dev/" aria-label="非开发问题"><FontIcon icon="github"></FontIcon>非开发问题<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/interview-shorthand/" aria-label="💯面试速记"><FontIcon icon="about"></FontIcon>💯面试速记<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/notebook/" aria-label="🫵笔记本"><FontIcon icon="book"></FontIcon>🫵笔记本<!----></a></div><div class="nav-item hide-in-mobile"><a class="route-link nav-link" href="/Note-Book/algorithm/" aria-label="🧮算法"><FontIcon icon="book"></FontIcon>🧮算法<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="🤣网站相关"><span class="title"><FontIcon icon="about"></FontIcon>🤣网站相关</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/about-the-author/" aria-label="关于作者"><FontIcon icon="zuozhe"></FontIcon>关于作者<!----></a></li><li class="dropdown-item"><a class="route-link nav-link" href="/Note-Book/timeline/" aria-label="更新历史"><FontIcon icon="history"></FontIcon>更新历史<!----></a></li></ul></button></div></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/HollowLatte/Note-Book" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><GitHubIcon style="width:1.25rem;height:1.25rem;vertical-align:middle;"></GitHubIcon></a></div><div class="nav-item hide-in-mobile"><button type="button" id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><form class="search-box" role="search"><input type="search" placeholder="搜索" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="star"></FontIcon><span class="vp-sidebar-title">必看</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="interview"></FontIcon><span class="vp-sidebar-title">面试准备</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="java"></FontIcon><span class="vp-sidebar-title">Java</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="computer"></FontIcon><span class="vp-sidebar-title">计算机基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="database"></FontIcon><span class="vp-sidebar-title">数据库</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="tool"></FontIcon><span class="vp-sidebar-title">开发工具</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="component"></FontIcon><span class="vp-sidebar-title">常用框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="design"></FontIcon><span class="vp-sidebar-title">系统设计</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="distributed-network"></FontIcon><span class="vp-sidebar-title">分布式</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="et-performance"></FontIcon><span class="vp-sidebar-title">高性能</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="cdn"></FontIcon><span class="vp-sidebar-title">CDN</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/cdn.html" aria-label="CDN常见问题总结"><FontIcon></FontIcon>CDN常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="fuzaijunheng"></FontIcon><span class="vp-sidebar-title">负载均衡</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/load-balancing.html" aria-label="负载均衡常见问题总结"><FontIcon></FontIcon>负载均衡常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><FontIcon icon="mysql"></FontIcon><span class="vp-sidebar-title">数据库优化</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/read-and-write-separation-and-library-subtable.html" aria-label="读写分离和分库分表常见问题总结"><FontIcon></FontIcon>读写分离和分库分表常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/sql-optimization.html" aria-label="/high-performance/sql-optimization.html"><FontIcon></FontIcon>/high-performance/sql-optimization.html<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable active" type="button"><FontIcon icon="MQ"></FontIcon><span class="vp-sidebar-title">消息队列</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/message-queue/message-queue.html" aria-label="消息队列基础知识总结"><FontIcon></FontIcon>消息队列基础知识总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!----></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/message-queue/kafka-questions-01.html" aria-label="Kafka常见问题总结"><FontIcon></FontIcon>Kafka常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/message-queue/rocketmq-questions.html" aria-label="RocketMQ常见问题总结"><FontIcon></FontIcon>RocketMQ常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="route-link nav-link vp-sidebar-link vp-sidebar-page" href="/Note-Book/high-performance/message-queue/rabbitmq-questions.html" aria-label="RabbitMQ常见问题总结"><FontIcon></FontIcon>RabbitMQ常见问题总结<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-heading clickable" type="button"><FontIcon icon="highavailable"></FontIcon><span class="vp-sidebar-title">高可用</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!--[--><!----><!--]--><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><FontIcon></FontIcon>Disruptor常见问题总结</h1><div class="page-info"><AuthorInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></AuthorInfo><CategoryInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></CategoryInfo><TagInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></TagInfo><DateInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></DateInfo><OriginalInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></OriginalInfo><WordInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></WordInfo><ReadingTimeInfo localizeddate="2024年3月21日" isoriginal="false" pageview="true" pure="true"></ReadingTimeInfo></div><hr></div><!----><!--[--><!----><!--]--><div class="theme-hope-content"><p>Disruptor 是一个相对冷门一些的知识点，不过，如果你的项目经历中用到了 Disruptor 的话，那面试中就很可能会被问到。</p><p>一位球友之前投稿的面经（社招）中就涉及一些 Disruptor 的问题，文章传送门：<a href="https://mp.weixin.qq.com/s/C5QMjwEb6pzXACqZsyqC4A" target="_blank" rel="noopener noreferrer">圆梦！顺利拿到字节、淘宝、拼多多等大厂 offer！<!----></a> 。</p><figure><img src="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-interview-questions.png" alt="" tabindex="0"><figcaption></figcaption></figure><p>这篇文章可以看作是对 Disruptor 做的一个简单总结，每个问题都不会扯太深入，主要针对面试或者速览 Disruptor。</p><h2 id="disruptor-是什么" tabindex="-1"><a class="header-anchor" href="#disruptor-是什么"><span>Disruptor 是什么？</span></a></h2><p>Disruptor 是一个开源的高性能内存队列，诞生初衷是为了解决内存队列的性能和内存安全问题，由英国外汇交易公司 LMAX 开发。</p><p>根据 Disruptor 官方介绍，基于 Disruptor 开发的系统 LMAX（新的零售金融交易平台），单线程就能支撑每秒 600 万订单。Martin Fowler 在 2011 年写的一篇文章 <a href="https://martinfowler.com/articles/lmax.html" target="_blank" rel="noopener noreferrer">The LMAX Architecture<!----></a> 中专门介绍过这个 LMAX 系统的架构，感兴趣的可以看看这篇文章。。</p><p>LMAX 公司 2010 年在 QCon 演讲后，Disruptor 获得了业界关注，并获得了 2011 年的 Oracle 官方的 Duke&#39;s Choice Awards(Duke 选择大奖)。</p><figure><img src="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/640.png" alt="" tabindex="0"><figcaption></figcaption></figure><blockquote><p>“Duke 选择大奖”旨在表彰过去一年里全球个人或公司开发的、最具影响力的 Java 技术应用，由甲骨文公司主办。含金量非常高！</p></blockquote><p>我专门找到了 Oracle 官方当年颁布获得 Duke&#39;s Choice Awards 项目的那篇文章（文章地址：https://blogs.oracle.com/java/post/and-the-winners-arethe-dukes-choice-award） 。从文中可以看出，同年获得此大奖荣誉的还有大名鼎鼎的 Netty、JRebel 等项目。</p><figure><img src="https://oss.javaguide.cn/javaguide/image-20211015152323898.png" alt="2011 年的 Oracle 官方的 Duke&#39;s Choice Awards" tabindex="0"><figcaption>2011 年的 Oracle 官方的 Duke&#39;s Choice Awards</figcaption></figure><p>Disruptor 提供的功能优点类似于 Kafka、RocketMQ 这类分布式队列，不过，其作为范围是 JVM(内存)。</p><ul><li>Github 地址：<a href="https://github.com/LMAX-Exchange/disruptor" target="_blank" rel="noopener noreferrer">https://github.com/LMAX-Exchange/disruptor<!----></a></li><li>官方教程： <a href="https://lmax-exchange.github.io/disruptor/user-guide/index.html" target="_blank" rel="noopener noreferrer">https://lmax-exchange.github.io/disruptor/user-guide/index.html<!----></a></li></ul><p>关于如何在 Spring Boot 项目中使用 Disruptor，可以看这篇文章：<a href="https://mp.weixin.qq.com/s/0iG5brK3bYF0BgSjX4jRiA" target="_blank" rel="noopener noreferrer">Spring Boot + Disruptor 实战入门<!----></a> 。</p><h2 id="为什么要用-disruptor" tabindex="-1"><a class="header-anchor" href="#为什么要用-disruptor"><span>为什么要用 Disruptor？</span></a></h2><p>Disruptor 主要解决了 JDK 内置线程安全队列的性能和内存安全问题。</p><p><strong>JDK 中常见的线程安全的队列如下</strong>：</p><table><thead><tr><th>队列名字</th><th>锁</th><th>是否有界</th></tr></thead><tbody><tr><td><code>ArrayBlockingQueue</code></td><td>加锁（<code>ReentrantLock</code>）</td><td>有界</td></tr><tr><td><code>LinkedBlockingQueue</code></td><td>加锁（<code>ReentrantLock</code>）</td><td>有界</td></tr><tr><td><code>LinkedTransferQueue</code></td><td>无锁（<code>CAS</code>）</td><td>无界</td></tr><tr><td><code>ConcurrentLinkedQueue</code></td><td>无锁（<code>CAS</code>）</td><td>无界</td></tr></tbody></table><p>从上表中可以看出：这些队列要不就是加锁有界，要不就是无锁无界。而加锁的的队列势必会影响性能，无界的队列又存在内存溢出的风险。</p><p>因此，一般情况下，我们都是不建议使用 JDK 内置线程安全队列。</p><p><strong>Disruptor 就不一样了！它在无锁的情况下还能保证队列有界，并且还是线程安全的。</strong></p><p>下面这张图是 Disruptor 官网提供的 Disruptor 和 ArrayBlockingQueue 的延迟直方图对比。</p><figure><img src="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-latency-histogram.png" alt="disruptor-latency-histogram" tabindex="0"><figcaption>disruptor-latency-histogram</figcaption></figure><p>Disruptor 真的很快，关于它为什么这么快这个问题，会在后文介绍到。</p><p>此外，Disruptor 还提供了丰富的扩展功能比如支持批量操作、支持多种等待策略。</p><h2 id="kafka-和-disruptor-什么区别" tabindex="-1"><a class="header-anchor" href="#kafka-和-disruptor-什么区别"><span>Kafka 和 Disruptor 什么区别？</span></a></h2><ul><li><strong>Kafka</strong>：分布式消息队列，一般用在系统或者服务之间的消息传递，还可以被用作流式处理平台。</li><li><strong>Disruptor</strong>：内存级别的消息队列，一般用在系统内部中线程间的消息传递。</li></ul><h2 id="哪些组件用到了-disruptor" tabindex="-1"><a class="header-anchor" href="#哪些组件用到了-disruptor"><span>哪些组件用到了 Disruptor？</span></a></h2><p>用到 Disruptor 的开源项目还是挺多的，这里简单举几个例子：</p><ul><li><strong>Log4j2</strong>：Log4j2 是一款常用的日志框架，它基于 Disruptor 来实现异步日志。</li><li><strong>SOFATracer</strong>：SOFATracer 是蚂蚁金服开源的分布式应用链路追踪工具，它基于 Disruptor 来实现异步日志。</li><li><strong>Storm</strong> : Storm 是一个开源的分布式实时计算系统，它基于 Disruptor 来实现工作进程内发生的消息传递（同一 Storm 节点上的线程间，无需网络通信）。</li><li><strong>HBase</strong>：HBase 是一个分布式列存储数据库系统，它基于 Disruptor 来提高写并发性能。</li><li>......</li></ul><h2 id="disruptor-核心概念有哪些" tabindex="-1"><a class="header-anchor" href="#disruptor-核心概念有哪些"><span>Disruptor 核心概念有哪些？</span></a></h2><ul><li><strong>Event</strong>：你可以把 Event 理解为存放在队列中等待消费的消息对象。</li><li><strong>EventFactory</strong>：事件工厂用于生产事件，我们在初始化 <code>Disruptor</code> 类的时候需要用到。</li><li><strong>EventHandler</strong>：Event 在对应的 Handler 中被处理，你可以将其理解为生产消费者模型中的消费者。</li><li><strong>EventProcessor</strong>：EventProcessor 持有特定消费者(Consumer)的 Sequence，并提供用于调用事件处理实现的事件循环(Event Loop)。</li><li><strong>Disruptor</strong>：事件的生产和消费需要用到 <code>Disruptor</code> 对象。</li><li><strong>RingBuffer</strong>：RingBuffer（环形数组）用于保存事件。</li><li><strong>WaitStrategy</strong>：等待策略。决定了没有事件可以消费的时候，事件消费者如何等待新事件的到来。</li><li><strong>Producer</strong>：生产者，只是泛指调用 <code>Disruptor</code> 对象发布事件的用户代码，Disruptor 没有定义特定接口或类型。</li><li><strong>ProducerType</strong>：指定是单个事件发布者模式还是多个事件发布者模式（发布者和生产者的意思类似，我个人比较喜欢用发布者）。</li><li><strong>Sequencer</strong>：Sequencer 是 Disruptor 的真正核心。此接口有两个实现类 <code>SingleProducerSequencer</code>、<code>MultiProducerSequencer</code> ，它们定义在生产者和消费者之间快速、正确地传递数据的并发算法。</li></ul><p>下面这张图摘自 Disruptor 官网，展示了 LMAX 系统使用 Disruptor 的示例。</p><figure><img src="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/disruptor-models.png" alt="LMAX 系统使用 Disruptor 的示例" tabindex="0"><figcaption>LMAX 系统使用 Disruptor 的示例</figcaption></figure><h2 id="disruptor-等待策略有哪些" tabindex="-1"><a class="header-anchor" href="#disruptor-等待策略有哪些"><span>Disruptor 等待策略有哪些？</span></a></h2><p><strong>等待策略（WaitStrategy）</strong> 决定了没有事件可以消费的时候，事件消费者如何等待新事件的到来。</p><p>常见的等待策略有下面这些：</p><figure><img src="https://oss.javaguide.cn/github/javaguide/high-performance/message-queue/DisruptorWaitStrategy.png" alt="Disruptor 等待策略" tabindex="0"><figcaption>Disruptor 等待策略</figcaption></figure><ul><li><code>BlockingWaitStrategy</code>：基于 <code>ReentrantLock</code>+<code>Condition</code> 来实现等待和唤醒操作，实现代码非常简单，是 Disruptor 默认的等待策略。虽然最慢，但也是 CPU 使用率最低和最稳定的选项生产环境推荐使用；</li><li><code>BusySpinWaitStrategy</code>：性能很好，存在持续自旋的风险，使用不当会造成 CPU 负载 100%，慎用；</li><li><code>LiteBlockingWaitStrategy</code>：基于 <code>BlockingWaitStrategy</code> 的轻量级等待策略，在没有锁竞争的时候会省去唤醒操作，但是作者说测试不充分，因此不建议使用;</li><li><code>TimeoutBlockingWaitStrategy</code>：带超时的等待策略，超时后会执行业务指定的处理逻辑;</li><li><code>LiteTimeoutBlockingWaitStrategy</code>：基于<code>TimeoutBlockingWaitStrategy</code>的策略，当没有锁竞争的时候会省去唤醒操作;</li><li><code>SleepingWaitStrategy</code>：三段式策略，第一阶段自旋，第二阶段执行 Thread.yield 让出 CPU，第三阶段睡眠执行时间，反复的睡眠；</li><li><code>YieldingWaitStrategy</code>：二段式策略，第一阶段自旋，第二阶段执行 Thread.yield 交出 CPU;</li><li><code>PhasedBackoffWaitStrategy</code>：四段式策略，第一阶段自旋指定次数，第二阶段自旋指定时间，第三阶段执行 <code>Thread.yield</code> 交出 CPU，第四阶段调用成员变量的<code>waitFor</code>方法，该成员变量可以被设置为<code>BlockingWaitStrategy</code>、<code>LiteBlockingWaitStrategy</code>、<code>SleepingWaitStrategy</code>三个中的一个。</li></ul><h2 id="disruptor-为什么这么快" tabindex="-1"><a class="header-anchor" href="#disruptor-为什么这么快"><span>Disruptor 为什么这么快？</span></a></h2><ul><li><strong>RingBuffer（环形数组）</strong> : Disruptor 内部的 RingBuffer 是通过数组实现的。由于这个数组中的所有元素在初始化时一次性全部创建，因此这些元素的内存地址一般来说是连续的。这样做的好处是，当生产者不断往 RingBuffer 中插入新的事件对象时，这些事件对象的内存地址就能够保持连续，从而利用 CPU 缓存的局部性原理，将相邻的事件对象一起加载到缓存中，提高程序的性能。这类似于 MySQL 的预读机制，将连续的几个页预读到内存里。除此之外，RingBuffer 基于数组还支持批量操作（一次处理多个元素）、还可以避免频繁的内存分配和垃圾回收（RingBuffer 是一个固定大小的数组，当向数组中添加新元素时，如果数组已满，则新元素将覆盖掉最旧的元素）。</li><li><strong>避免了伪共享问题</strong>：CPU 缓存内部是按照 Cache Line（缓存行）管理的，一般的 Cache Line 大小在 64 字节左右。Disruptor 为了确保目标字段独占一个 Cache Line，会在目标字段前后增加了 64 个字节的填充（前 56 个字节和后 8 个字节），这样可以避免 Cache Line 的伪共享（False Sharing）问题。</li><li><strong>无锁设计</strong>：Disruptor 采用无锁设计，避免了传统锁机制带来的竞争和延迟。Disruptor 的无锁实现起来比较复杂，主要是基于 CAS、内存屏障（Memory Barrier）、RingBuffer 等技术实现的。</li></ul><p>综上所述，Disruptor 之所以能够如此快，是基于一系列优化策略的综合作用，既充分利用了现代 CPU 缓存结构的特点，又避免了常见的并发问题和性能瓶颈。</p><p>关于 Disruptor 高性能队列原理的详细介绍，可以查看这篇文章：<a href="https://qin.news/disruptor/" target="_blank" rel="noopener noreferrer">Disruptor 高性能队列原理浅析<!----></a> （参考了美团技术团队的<a href="https://tech.meituan.com/2016/11/18/disruptor.html" target="_blank" rel="noopener noreferrer">高性能队列——Disruptor<!----></a>这篇文章）。</p><p>🌈 这里额外补充一点：<strong>数组中对象元素地址连续为什么可以提高性能？</strong></p><p>CPU 缓存是通过将最近使用的数据存储在高速缓存中来实现更快的读取速度，并使用预取机制提前加载相邻内存的数据以利用局部性原理。</p><p>在计算机系统中，CPU 主要访问高速缓存和内存。高速缓存是一种速度非常快、容量相对较小的内存，通常被分为多级缓存，其中 L1、L2、L3 分别表示一级缓存、二级缓存、三级缓存。越靠近 CPU 的缓存，速度越快，容量也越小。相比之下，内存容量相对较大，但速度较慢。</p><figure><img src="https://oss.javaguide.cn/github/javaguide/java/concurrent/cpu-cache.png" alt="CPU 缓存模型示意图" tabindex="0"><figcaption>CPU 缓存模型示意图</figcaption></figure><p>为了加速数据的读取过程，CPU 会先将数据从内存中加载到高速缓存中，如果下一次需要访问相同的数据，就可以直接从高速缓存中读取，而不需要再次访问内存。这就是所谓的 <strong>缓存命中</strong> 。另外，为了利用 <strong>局部性原理</strong> ，CPU 还会根据之前访问的内存地址预取相邻的内存数据，因为在程序中，连续的内存地址通常会被频繁访问到，这样做可以提高数据的缓存命中率，进而提高程序的性能。</p><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li>Disruptor 高性能之道-等待策略：<a href="http://wuwenliang.net/2022/02/28/Disruptor%E9%AB%98%E6%80%A7%E8%83%BD%E4%B9%8B%E9%81%93-%E7%AD%89%E5%BE%85%E7%AD%96%E7%95%A5/" target="_blank" rel="noopener noreferrer">http://wuwenliang.net/2022/02/28/Disruptor高性能之道-等待策略/<!----></a></li><li>《Java 并发编程实战》- 40 | 案例分析（三）：高性能队列 Disruptor：<a href="https://time.geekbang.org/column/article/98134" target="_blank" rel="noopener noreferrer">https://time.geekbang.org/column/article/98134<!----></a></li></ul></div><!--[--><!----><!--]--><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/HollowLatte/Note-Book/edit/main/docs/high-performance/message-queue/disruptor-questions.md" rel="noopener noreferrer" target="_blank" aria-label="编辑此页" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: hollowlatte@outlook.com">hollowlatte</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link nav-link prev" href="/Note-Book/high-performance/message-queue/message-queue.html" aria-label="消息队列基础知识总结"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><FontIcon></FontIcon>消息队列基础知识总结</div></a><a class="route-link nav-link next" href="/Note-Book/high-performance/message-queue/kafka-questions-01.html" aria-label="Kafka常见问题总结"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">Kafka常见问题总结<FontIcon></FontIcon></div></a></nav><!----><!--[--><!----><!--]--><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="https://beian.miit.gov.cn/" target="_blank">鄂ICP备2020015769号-1</a></div><div class="vp-copyright">Copyright © 2024 Hollow-Latte </div></footer></div><!--]--><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/Note-Book/assets/app-CDroZFTS.js" defer></script>
  </body>
</html>
